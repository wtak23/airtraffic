


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.2 Regression analysis</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/font-awesome-4.7.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="" href="index.html" />
    <link rel="up" title="2 Python Codes in Jupyter Notebook" href="jupyter_notebooks.html" />
    <link rel="next" title="2.3 Network analysis" href="network.html" />
    <link rel="prev" title="2.1 Air-traffic Count Analysis" href="flight-count-analysis1.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          US Airport Traffic Analysis</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://takwatanabe.me"><i class="fa fa-home" aria-hidden="true"></i>&nbsp; takwatanabe.me</a></li>
                <li><a href="https://github.com/wtak23/airtraffic"><i class="fa fa-github" aria-hidden="true"></i>&nbsp; Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">TOC <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main_findings.html">1 Summary of Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="main_findings.html#air-traffics">1.1 Air-traffics</a></li>
<li class="toctree-l2"><a class="reference internal" href="main_findings.html#national-holidays-salient-in-reisual-air-traffic-residuals-signal">1.2 National holidays salient in reisual air-traffic residuals signal</a></li>
<li class="toctree-l2"><a class="reference internal" href="main_findings.html#preliminary-graph-theory-analysis-based-on-airtraffic-network-structure">1.3 Preliminary graph theory analysis based on airtraffic network structure</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="jupyter_notebooks.html">2 Python Codes in Jupyter Notebook</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis1.html">2.1 Air-traffic Count Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis1.html#load-data">2.1.1 Load data</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis1.html#create-timeseries-of-daily-flight-counts">2.1.2 Create Timeseries of Daily Flight Counts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#create-interactive-plot-with-plotly-cufflinks">2.1.2.1 Create interactive plot with plotly/cufflinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#study-seasonal-trend-with-rolling-averaged-timeseries">2.1.2.2 Study seasonal trend with rolling-averaged timeseries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis1.html#flight-counts-study-by-day-of-week-and-month">2.1.3 Flight counts study by &#8220;day_of_week&#8221; and &#8220;month&#8221;</a><ul>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#over-entire-year">2.1.3.1 Over entire year</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#apply-pivoting-to-groupby-month-and-day-of-week">2.1.3.2 Apply pivoting to groupby month and day_of_week</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis1.html#repeat-analysis-for-ny-la-and-vegas">2.1.4 Repeat analysis for NY, LA, and Vegas.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#data-tidying">2.1.4.1 Data tidying</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#plot-results">2.1.4.2 Plot results</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#create-sublots-of-monthly-flight-count-trends-for-each-city">2.1.4.3 Create sublots of monthly flight-count trends for each city</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis1.html#which-state-had-the-most-air-traffics">2.1.5 Which state had the most air traffics?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#id1">2.1.5.1 Data tidying</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#choropleth-figure-display-result-on-us-map">2.1.5.2 Choropleth figure (display result on US map)</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#choropleth-after-normalizing-over-state-population">2.1.5.3 Choropleth after normalizing over state population</a></li>
<li class="toctree-l4"><a class="reference internal" href="flight-count-analysis1.html#normalized-flight-counts-at-different-month">2.1.5.4 Normalized flight-counts at different month?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis1.html#flight-counts-by-airport">2.1.6 Flight-counts by airport</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="">2.2 Regression analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aim-of-this-notebook">2.2.1 Aim of this notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-data-and-prepare-timeseries">2.2.2 Load data, and prepare Timeseries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regression-analysis-eliminate-effect-from-day-of-week">2.2.3 Regression analysis: eliminate effect from &#8220;day_of_week&#8221;</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fit-ols-model">2.2.3.1 Fit OLS model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analyze-residual-signal">2.2.3.2 Analyze residual signal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-lagged-residual">2.2.3.3 Get &#8220;Lagged&#8221; residual</a></li>
<li class="toctree-l4"><a class="reference internal" href="#histograms-of-the-signals">2.2.3.4 Histograms of the signals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repeat-analysis-for-3-years-period">2.2.4 Repeat analysis for 3 years period</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#try-overlaying-the-annual-plot">2.2.4.1 Try overlaying the annual plot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="network.html">2.3 Network analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_munging.html">3 Data munging (some elbow grease)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spotify_0105a.html">3.1 Study <code class="docutils literal"><span class="pre">carriers.xls</span></code> and <code class="docutils literal"><span class="pre">airports</span> <span class="pre">new.xlt</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="spotify_0105a.html#study-the-carrier-spreadsheet">3.1.1 Study the &#8220;carrier&#8221; spreadsheet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#sort-out-the-nan-values">3.1.1.1 sort out the &#8220;nan&#8221; values</a></li>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#filter-away-nans-from-the-dataframe">3.1.1.2 Filter away nans from the DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#realized-some-code-is-treated-as-int-convert-to-string">3.1.1.3 Realized some <em>Code</em> is treated as int...convert to string</a></li>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#what-s-the-deal-with-the-1-appended-to-some-of-the-entries">3.1.1.4 What&#8217;s the deal with the (1) appended to some of the entries?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spotify_0105a.html#study-airports-spreadsheet">3.1.2 Study <em>airports</em> spreadsheet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#study-nans">3.1.2.1 Study nans</a></li>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#filter-out-non-usa-airports">3.1.2.2 Filter out non-USA airports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="spotify_0105a.html#study-airports-state-distribution">3.1.3 Study &#8220;airports&#8221; state distribution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#plot-bubble-markers-for-all-airports">3.1.3.1 Plot bubble markers for all airports</a></li>
<li class="toctree-l4"><a class="reference internal" href="spotify_0105a.html#take-a-closer-look-at-michigan-my-home-state">3.1.3.2 Take a closer look at Michigan, my home state</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="create_lookup_table.html">3.2 Create Lookup Table</a><ul>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#aim-of-notebook">3.2.1 Aim of notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#load-the-main-airport-traffic-data">3.2.2 Load the main airport traffic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#load-lookup-table-provided-by-bts">3.2.3 Load lookup table provided by BTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#create-enhanced-lookuptable">3.2.4 Create <em>enhanced</em> lookuptable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#remove-code-that-is-not-present-our-dataset">3.2.4.1 Remove Code that is not present our dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#parse-state-city-and-airport-name-from-description-field">3.2.4.2 Parse state,city, and airport-name from &#8216;Description&#8217; field</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#add-state-region-information">3.2.4.3 Add state &#8216;region&#8217; information</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#add-airport-latitude-and-longitude-information-using-google-geocoder">3.2.4.4 Add airport latitude and longitude information using Google geocoder</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="test.html">3.3 Test</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">2.2 Regression analysis</a><ul>
<li><a class="reference internal" href="#aim-of-this-notebook">2.2.1 Aim of this notebook</a></li>
<li><a class="reference internal" href="#load-data-and-prepare-timeseries">2.2.2 Load data, and prepare Timeseries</a></li>
<li><a class="reference internal" href="#regression-analysis-eliminate-effect-from-day-of-week">2.2.3 Regression analysis: eliminate effect from &#8220;day_of_week&#8221;</a><ul>
<li><a class="reference internal" href="#fit-ols-model">2.2.3.1 Fit OLS model</a></li>
<li><a class="reference internal" href="#analyze-residual-signal">2.2.3.2 Analyze residual signal</a></li>
<li><a class="reference internal" href="#get-lagged-residual">2.2.3.3 Get &#8220;Lagged&#8221; residual</a></li>
<li><a class="reference internal" href="#histograms-of-the-signals">2.2.3.4 Histograms of the signals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#repeat-analysis-for-3-years-period">2.2.4 Repeat analysis for 3 years period</a><ul>
<li><a class="reference internal" href="#try-overlaying-the-annual-plot">2.2.4.1 Try overlaying the annual plot</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="regression-analysis">
<h1>2.2 Regression analysis</h1>
<p>The original ipython notebook can be downloaded from <a class="reference external" href="http://nbviewer.jupyter.org/github/wtak23/airtraffic/blob/master/final_scripts/regressing_out_weekday_effect.ipynb">here</a> .</p>
<div class="contents local topic" id="page-contents">
<p class="topic-title first"><cite>Page Contents</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#aim-of-this-notebook" id="id1">Aim of this notebook</a></li>
<li><a class="reference internal" href="#load-data-and-prepare-timeseries" id="id2">Load data, and prepare Timeseries</a></li>
<li><a class="reference internal" href="#regression-analysis-eliminate-effect-from-day-of-week" id="id3">Regression analysis: eliminate effect from &#8220;day_of_week&#8221;</a><ul>
<li><a class="reference internal" href="#fit-ols-model" id="id4">Fit OLS model</a></li>
<li><a class="reference internal" href="#analyze-residual-signal" id="id5">Analyze residual signal</a></li>
<li><a class="reference internal" href="#get-lagged-residual" id="id6">Get &#8220;Lagged&#8221; residual</a></li>
<li><a class="reference internal" href="#histograms-of-the-signals" id="id7">Histograms of the signals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#repeat-analysis-for-3-years-period" id="id8">Repeat analysis for 3 years period</a><ul>
<li><a class="reference internal" href="#try-overlaying-the-annual-plot" id="id9">Try overlaying the annual plot</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="aim-of-this-notebook">
<h2><a class="toc-backref" href="#id1">2.2.1 Aim of this notebook</a></h2>
<ul class="simple">
<li>In our <a class="reference external" href="http://takwatanabe.me/airtraffic/flight-count-analysis1.html">air-traffic count
analysis</a>,
we found from the following plot that when the time-series signal of
the airtraffic-counts is heavily influenced by &#8220;<em>what day of the week
it is</em>.&#8221;, indicating that people tend to fly out less especially on
Saturdays.</li>
<li>This <code class="docutils literal"><span class="pre">day_of_week</span></code> effect seems to obscure away interesting trend
in our data.</li>
</ul>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1555.embed?link=false&logo=false" height="525px" width="100%"></iframe><ul class="simple">
<li>So in this notebook, we&#8217;ll aim to <strong>linearly regress out</strong> the effect
of <code class="docutils literal"><span class="pre">day_of_week</span></code> by using a linear regression model</li>
<li>The regressors will be the <code class="docutils literal"><span class="pre">day_of_week</span></code>, encoded by a categorical
<a class="reference external" href="https://en.wikipedia.org/wiki/Dummy_variable_(statistics)">dummy
variables</a>
(called <code class="docutils literal"><span class="pre">factor</span></code> in R)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>%matplotlib inline
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn.apionly as sns
import plotly.plotly as py
import calendar

from datetime import datetime
from pprint import pprint
from IPython.display import display

import cufflinks as cf
cf.set_config_file(theme=&#39;ggplot&#39;,sharing=&#39;secret&#39;)

import util

# limit output to avoid cluttering screen
pd.options.display.max_rows = 20
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># name of output files to prepend with</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;regressing_out_weekday_effect&#39;</span>
<span class="n">period</span> <span class="o">=</span> <span class="s1">&#39;11/1/2015 to 10/31/2016&#39;</span> <span class="c1">#range of our analysis</span>
</pre></div>
</div>
</div>
<div class="section" id="load-data-and-prepare-timeseries">
<h2><a class="toc-backref" href="#id2">2.2.2 Load data, and prepare Timeseries</a></h2>
<ul class="simple">
<li>Here I&#8217;ll quickly repeat the procedure I took in my previous notebook
(<a class="reference external" href="http://takwatanabe.me/airtraffic/flight-count-analysis1.html#create-timeseries-of-daily-flight-counts">link</a>)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">load_airport_data</span><span class="p">()</span>

<span class="n">hash_dayofweek</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Mon&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Tue&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Wed&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Thu&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;Fri&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="s1">&#39;Sat&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="s1">&#39;Sun&#39;</span><span class="p">}</span>
<span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;DAY_OF_WEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;DAY_OF_WEEK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="n">hash_dayofweek</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span> <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">11.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">12.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">01.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">02.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">03.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">04.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">05.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">06.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">07.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">08.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">09.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">10.</span><span class="n">zip</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># lookup table for the AIRPORT_ID</span>
<span class="n">df_lookup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;df_lookup.csv&#39;</span><span class="p">)</span>

<span class="c1"># create hash-table to convert Airport &quot;Code&quot; to &quot;City_State&quot; and &quot;Airport-name&quot;</span>
<span class="n">hash_lookup</span> <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;City_State&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">hash_airport</span> <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;Airport&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create a column containing &quot;YEAR-MONTH-DAY&quot; info</span>
<span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;YEAR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span>
                  <span class="o">+</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;MONTH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span>
                  <span class="o">+</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;DAY_OF_MONTH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># now we can create time-series of airtraffic counts</span>
<span class="n">ts_flightcounts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span>\
    <span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="s1">&#39;counts&#39;</span><span class="p">})</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># need to sort by date</span>

<span class="c1"># explicitly add extra date-info as dataframe columns (to apply `groupby` later)</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span>

<span class="c1"># `dayofweek` uses encoding Monday=0 ... Sunday=6...make this explicit</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;Mon&#39;</span><span class="p">,</span>
                                                                     <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Tue&#39;</span><span class="p">,</span>
                                                                     <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Wed&#39;</span><span class="p">,</span>
                                                                     <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Thu&#39;</span><span class="p">,</span>
                                                                     <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Fri&#39;</span><span class="p">,</span>
                                                                     <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;Sat&#39;</span><span class="p">,</span>
                                                                     <span class="mi">6</span><span class="p">:</span><span class="s1">&#39;Sun&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="c1"># create hover_text object for plotly</span>
<span class="n">hover_text</span><span class="o">=</span> <span class="p">(</span>
    <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="o">+</span> <span class="s1">&#39;/&#39;</span>  <span class="o">+</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">print</span> <span class="n">hover_text</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;11/1 (Sun)&#39;</span><span class="p">,</span> <span class="s1">&#39;11/2 (Mon)&#39;</span><span class="p">,</span> <span class="s1">&#39;11/3 (Tue)&#39;</span><span class="p">,</span> <span class="s1">&#39;11/4 (Wed)&#39;</span><span class="p">,</span> <span class="s1">&#39;11/5 (Thu)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">plt_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Daily Airflight Counts in the US between &#39;</span> <span class="o">+</span> <span class="n">period</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(hover over plot for dates; left-click to zoom)&#39;</span>

<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span>
                      <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;plot_flightcounts&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">plt_options</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1797.embed?share&link=false&logo=false_key=92EpEcQqajzsuT8jAt8LDS" height="525px" width="100%"></iframe><ul class="simple">
<li>Ok, we are in business. Let&#8217;s next run our regression analysis.</li>
</ul>
</div>
<div class="section" id="regression-analysis-eliminate-effect-from-day-of-week">
<h2><a class="toc-backref" href="#id3">2.2.3 Regression analysis: eliminate effect from &#8220;day_of_week&#8221;</a></h2>
<ul class="simple">
<li>Here we will apply linear regression using <code class="docutils literal"><span class="pre">day_of_week</span></code> encoded by
dummy-variables as the regressors.</li>
<li>By studying the residual-timeseries from this regression, we hope to
identify interesting trends that are buried under the dominant effect
of <code class="docutils literal"><span class="pre">day_of_week</span></code></li>
</ul>
<div class="section" id="fit-ols-model">
<h3><a class="toc-backref" href="#id4">2.2.3.1 Fit OLS model</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># i love statsmodels, as it allows me to apply R like syntax</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">as</span> <span class="nn">smf</span>

<span class="c1"># fit OLS model using categorical variables without intercept</span>
<span class="c1"># (so all dummy-variables receive a binary encoder in the design matrix)</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;counts ~ C(day_of_week) - 1&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">ts_flightcounts</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">mod</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>counts</td>      <th>  R-squared:         </th> <td>   0.553</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.545</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   73.96</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 11 Jan 2017</td> <th>  Prob (F-statistic):</th> <td>9.34e-60</td>
</tr>
<tr>
  <th>Time:</th>                 <td>12:24:22</td>     <th>  Log-Likelihood:    </th> <td> -3004.6</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   366</td>      <th>  AIC:               </th> <td>   6023.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   359</td>      <th>  BIC:               </th> <td>   6051.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     6</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
           <td></td>              <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th> <th>[95.0% Conf. Int.]</th>
</tr>
<tr>
  <th>C(day_of_week)[Fri]</th> <td> 1.605e+04</td> <td>  124.514</td> <td>  128.866</td> <td> 0.000</td> <td> 1.58e+04  1.63e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Mon]</th> <td> 1.604e+04</td> <td>  123.334</td> <td>  130.061</td> <td> 0.000</td> <td> 1.58e+04  1.63e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Sat]</th> <td> 1.312e+04</td> <td>  124.514</td> <td>  105.345</td> <td> 0.000</td> <td> 1.29e+04  1.34e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Sun]</th> <td> 1.518e+04</td> <td>  123.334</td> <td>  123.110</td> <td> 0.000</td> <td> 1.49e+04  1.54e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Thu]</th> <td> 1.599e+04</td> <td>  124.514</td> <td>  128.415</td> <td> 0.000</td> <td> 1.57e+04  1.62e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Tue]</th> <td> 1.578e+04</td> <td>  124.514</td> <td>  126.740</td> <td> 0.000</td> <td> 1.55e+04   1.6e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Wed]</th> <td> 1.595e+04</td> <td>  124.514</td> <td>  128.122</td> <td> 0.000</td> <td> 1.57e+04  1.62e+04</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>138.226</td> <th>  Durbin-Watson:     </th> <td>   0.904</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td> 802.535</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-1.478</td>  <th>  Prob(JB):          </th> <td>5.39e-175</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 9.625</td>  <th>  Cond. No.          </th> <td>    1.01</td>
</tr>
</table><ul class="simple">
<li>There are some interesting remarks I can make about the above
summary, but let&#8217;s just focus on the residual timeseries signal from
this regression model.</li>
</ul>
</div>
<div class="section" id="analyze-residual-signal">
<h3><a class="toc-backref" href="#id5">2.2.3.2 Analyze residual signal</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># add residual signal to our timeseries dataframe</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">resid</span>


<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Residual Signal in the Daily Airflight Counts ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(`day_of_week` used as regressors)&#39;</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span>
                      <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;plot_resid&#39;</span><span class="p">,</span>
                      <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1799.embed?share&link=false&logo=false_key=BF0DMZva3xxQFcxM1MYjnb" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Residual Signal in the Daily Airflight Counts ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(original signal overlaid in secondary y-axes)&#39;</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span>   <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span><span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                             <span class="n">secondary_y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">fig2</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;residual-overlaid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1805.embed?share&link=false&logo=false_key=miNWMfcO2toDdFhYS4UWJf" height="525px" width="100%"></iframe><ul class="simple">
<li>The cyclical effect from <code class="docutils literal"><span class="pre">day_of_week</span></code> has been fairly suppressed.</li>
<li>There are dominant <em>spikes</em> present around National holidays (eg,
Thanksgiving, Independence day), which makes sesne &#8212; many people,
myself included, tend to fly out during these vacation time :)</li>
</ul>
</div>
<div class="section" id="get-lagged-residual">
<h3><a class="toc-backref" href="#id6">2.2.3.3 Get &#8220;Lagged&#8221; residual</a></h3>
<ul class="simple">
<li>Let&#8217;s take this a step further, and compute and plot the &#8220;lagged&#8221;
residual plot by computing the &#8220;first-order-difference&#8221; in the
residual signal</li>
<li>this is given by: <code class="docutils literal"><span class="pre">resid_lag[t]</span> <span class="pre">=</span> <span class="pre">resid[t]</span> <span class="pre">-</span> <span class="pre">resid[t-1]</span></code></li>
<li>(coming from an electrical engineering background, I interpret this
as a high-pass filtering operation)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># also add &quot;lagged&quot; residual information</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span> <span class="o">=</span> \
    <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span>

<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Lagged Residual Signal of Airflight Counts in the US between {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(left click to zoom on figure; shaded region = +/-1.5 std-dev)&#39;</span>

<span class="n">annotations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">26</span><span class="p">):</span><span class="s1">&#39;Thanksgiving&#39;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">24</span><span class="p">):</span><span class="s1">&#39;Christmas Eve&#39;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span><span class="s1">&#39;New Years&#39;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span><span class="s1">&#39;??? Something happen ???&#39;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">29</span><span class="p">):</span><span class="s1">&#39;Memorials Day&#39;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span><span class="s1">&#39;Independence Day&#39;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span><span class="s1">&#39;Labor Day&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">std_</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="c1"># std-deviation</span>

<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;plot_resid_lag&#39;</span><span class="p">,</span>
    <span class="n">annotations</span><span class="o">=</span><span class="n">annotations</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
    <span class="c1">#hspan=[(-1.5*std_,1.5*std_)],</span>
    <span class="n">hspan</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">y0</span><span class="o">=-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">std_</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">std_</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1807.embed?share&link=false&logo=false_key=gZgt67hPMDug68ug3PsKwf" height="525px" width="100%"></iframe><ul class="simple">
<li>Pretty neat! The national holidays appear as huge &#8220;<em>spikes</em>&#8221; in the
signal!</li>
<li>There are some other mild &#8220;spikes&#8221; occuring at days I am not familiar
with (e.g., was February 7th last year a special day?)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Lagged Residual Signal in the Daily Airflight Counts ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(original signal overlaid in secondary y-axes; left click to select zooming region)&#39;</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span>   <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span><span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                             <span class="n">secondary_y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">],</span> <span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">fig2</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;resid-lag-overlaid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1809.embed?share&link=false&logo=false_key=OZtWbp85ihAeQoPk7bnbGm" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1">#| below create stacked subplot...not that interesting, so comment out</span>
<span class="c1"># title = &#39;Flight counts&#39;</span>
<span class="c1"># ts_flightcounts.iplot(y=[&#39;counts&#39;,&#39;residual&#39;,&#39;resid_lag&#39;],</span>
<span class="c1">#                       subplots=True, shape=(3,1),</span>
<span class="c1">#                       text=hover_text,</span>
<span class="c1">#                       shared_xaxes=True,</span>
<span class="c1">#                       title=title,</span>
<span class="c1">#                       filename=outfile+&#39;flightcounts_subplot&#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="histograms-of-the-signals">
<h3><a class="toc-backref" href="#id7">2.2.3.4 Histograms of the signals</a></h3>
<ul class="simple">
<li>The <em>spike</em> detection approach above seems like an &#8220;anomaly
detection&#8221; or &#8220;outlier detection problem.</li>
<li>Since there are several (heuristic) outlier detection method that
relies on normality assumptions, let&#8217;s quickly study the distribution
of the time series signal</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plotly.tools</span> <span class="kn">import</span> <span class="n">FigureFactory</span> <span class="k">as</span> <span class="n">FF</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">,</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span>
<span class="n">colors</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>
<span class="n">group_data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">columns</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">create_distplot</span><span class="p">(</span><span class="n">group_data</span><span class="p">,</span>
                         <span class="n">group_labels</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
                         <span class="n">bin_size</span><span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
                         <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                         <span class="n">curve_type</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span><span class="c1">#&#39;kde&#39; or &#39;normal&#39;</span>
<span class="p">)</span>

<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Distributions among the three quantities of interest ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(KDE of the lagged residual looks sufficiently bell curvy?)&#39;</span>

<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;histogram2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1811.embed?share&link=false&logo=false_key=Id7ybFN2fZfkCXnhxvsiYT" height="525px" width="100%"></iframe><ul class="simple">
<li>test of normality is quite a heavily debated topic, so I will refrain
myself on discussing about it too much</li>
<li>(for exmple, with large sample size, your chance of rejecting the
null based on pvalues gets very high, regardless of the
distributional assumption you make on the test statistics)</li>
<li>but based on the above plot, the <code class="docutils literal"><span class="pre">lagged_residual_plot</span></code> looks
sufficiently normal to my eyes (perhaps an <a class="reference external" href="https://en.wikipedia.org/wiki/Heavy-tailed_distribution">subexponential
distribution</a>,
based on its heavy tail...can be an interesting reserch topic)</li>
</ul>
</div>
</div>
<div class="section" id="repeat-analysis-for-3-years-period">
<h2><a class="toc-backref" href="#id8">2.2.4 Repeat analysis for 3 years period</a></h2>
<ul class="simple">
<li>Just for kicks, I further downloaded data over 2 additional years
(from Nov2013-Oct2015), to see if similar pattern appeared in
previous years.</li>
<li>The code below is merely a carbon copy of the above.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">load_airport_data_3years</span><span class="p">()</span>
<span class="n">period</span> <span class="o">=</span> <span class="s1">&#39;11/1/2013 to 10/31/2016&#39;</span> <span class="c1">#range of our analysis</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span> <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2013</span><span class="o">-</span><span class="mf">11.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2013</span><span class="o">-</span><span class="mf">12.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">01.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">02.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">03.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">04.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">05.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">06.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">07.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">08.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">09.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">10.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">11.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2014</span><span class="o">-</span><span class="mf">12.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">01.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">02.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">03.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">04.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">05.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">06.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">07.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">08.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">09.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">10.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">11.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">12.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">01.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">02.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">03.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">04.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">05.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">06.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">07.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">08.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">09.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">10.</span><span class="n">zip</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create a column containing &quot;YEAR-MONTH-DAY&quot;</span>
<span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;YEAR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span>
                  <span class="o">+</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;MONTH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span>
                  <span class="o">+</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;DAY_OF_MONTH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create time-series of airtraffic counts</span>
<span class="n">ts_flightcounts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="s1">&#39;counts&#39;</span><span class="p">})</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># need to sort by date</span>

<span class="c1"># explicitly add extra date-info as dataframe columns (to apply `groupby` later)</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span>

<span class="c1"># `dayofweek` uses encoding Monday=0 ... Sunday=6...make this explicit</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;Mon&#39;</span><span class="p">,</span>
                                                                     <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Tue&#39;</span><span class="p">,</span>
                                                                     <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Wed&#39;</span><span class="p">,</span>
                                                                     <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Thu&#39;</span><span class="p">,</span>
                                                                     <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Fri&#39;</span><span class="p">,</span>
                                                                     <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;Sat&#39;</span><span class="p">,</span>
                                                                     <span class="mi">6</span><span class="p">:</span><span class="s1">&#39;Sun&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="c1"># create hover_text object for plotly</span>
<span class="n">hover_text</span><span class="o">=</span> <span class="p">(</span>
    <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="o">+</span> <span class="s1">&#39;/&#39;</span>  <span class="o">+</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">plt_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Daily Airflight Counts in the US between &#39;</span> <span class="o">+</span> <span class="n">period</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(hover over plot for dates; left-click to zoom)&#39;</span>

<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span>
                      <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;plot_flightcounts3yrs&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">plt_options</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1813.embed?share&link=false&logo=false_key=ki26T9goZ2Vdx43NnU8qZb" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;counts ~ C(day_of_week) - 1&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">ts_flightcounts</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">mod</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>counts</td>      <th>  R-squared:         </th> <td>   0.540</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.537</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   212.7</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 11 Jan 2017</td> <th>  Prob (F-statistic):</th> <td>1.59e-179</td>
</tr>
<tr>
  <th>Time:</th>                 <td>12:27:02</td>     <th>  Log-Likelihood:    </th> <td> -9081.9</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1096</td>      <th>  AIC:               </th> <td>1.818e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1089</td>      <th>  BIC:               </th> <td>1.821e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     6</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
           <td></td>              <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th> <th>[95.0% Conf. Int.]</th>
</tr>
<tr>
  <th>C(day_of_week)[Fri]</th> <td> 1.652e+04</td> <td>   76.905</td> <td>  214.751</td> <td> 0.000</td> <td> 1.64e+04  1.67e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Mon]</th> <td> 1.653e+04</td> <td>   76.905</td> <td>  214.941</td> <td> 0.000</td> <td> 1.64e+04  1.67e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Sat]</th> <td> 1.341e+04</td> <td>   76.905</td> <td>  174.351</td> <td> 0.000</td> <td> 1.33e+04  1.36e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Sun]</th> <td>  1.56e+04</td> <td>   76.905</td> <td>  202.900</td> <td> 0.000</td> <td> 1.55e+04  1.58e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Thu]</th> <td> 1.646e+04</td> <td>   77.151</td> <td>  213.367</td> <td> 0.000</td> <td> 1.63e+04  1.66e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Tue]</th> <td> 1.612e+04</td> <td>   77.151</td> <td>  208.939</td> <td> 0.000</td> <td>  1.6e+04  1.63e+04</td>
</tr>
<tr>
  <th>C(day_of_week)[Wed]</th> <td> 1.627e+04</td> <td>   77.151</td> <td>  210.946</td> <td> 0.000</td> <td> 1.61e+04  1.64e+04</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>334.890</td> <th>  Durbin-Watson:     </th> <td>   0.796</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>1830.024</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-1.299</td>  <th>  Prob(JB):          </th> <td>    0.00</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 8.772</td>  <th>  Cond. No.          </th> <td>    1.00</td>
</tr>
</table><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># add residual signal to our timeseries dataframe</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">resid</span>

<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Residual Signal in the Daily Airflight Counts ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(`day_of_week` used as regressors)&#39;</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span>
                      <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;plot_resid_3years&#39;</span><span class="p">,</span>
                      <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1819.embed?share&link=false&logo=false_key=vlfcxJfo1KSoFHHsIQsNn0" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Residual Signal in the Daily Airflight Counts ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(original signal overlaid in secondary y-axes)&#39;</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span>   <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span><span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                             <span class="n">secondary_y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">fig2</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;residual-overlaid_3years&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1821.embed?share&link=false&logo=false_key=pCiPLG6CDNgpQf2zpWx6LO" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># also add &quot;lagged&quot; residual information</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span> <span class="o">=</span> \
    <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span>

<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Lagged Residual Plot of Airflight Counts in the US ({})(left click to zoom)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(&quot;day-of-week&quot; used as regressors; shaded region = +/-1.5 std-dev)&#39;</span>

<span class="n">std_</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;plot_resid_lag_3years&#39;</span><span class="p">,</span>
    <span class="n">hspan</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">y0</span><span class="o">=-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">std_</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">std_</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1817.embed?share&link=false&logo=false_key=lgPen2YeoNXEvEBbXRWvOj" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Lagged Residual Signal in the Daily Airflight Counts ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(original signal overlaid in secondary y-axes; left click to select zooming region)&#39;</span>

<span class="n">fig1</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span>   <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span><span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">hover_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                             <span class="n">secondary_y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">],</span> <span class="n">asFigure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">fig2</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;resid-lag-overlaid_3years&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1825.embed?share&link=false&logo=false_key=u82qeAgOF2RqhNxIADGimh" height="525px" width="100%"></iframe><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">,</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">]</span>
<span class="n">colors</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">]</span>
<span class="n">group_data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">columns</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">create_distplot</span><span class="p">(</span><span class="n">group_data</span><span class="p">,</span>
                         <span class="n">group_labels</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
                         <span class="n">bin_size</span><span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
                         <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                         <span class="n">curve_type</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span><span class="c1">#&#39;kde&#39; or &#39;normal&#39;</span>
<span class="p">)</span>

<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Distributions among the three quantities of interest ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>

<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;histogram3years&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1823.embed?share&link=false&logo=false_key=NC65bD2dR9ZTSbfCPCUtts" height="525px" width="100%"></iframe><div class="section" id="try-overlaying-the-annual-plot">
<h3><a class="toc-backref" href="#id9">2.2.4.1 Try overlaying the annual plot</a></h3>
<ul class="simple">
<li>Turned out plotly&#8217;s data structure requires the full &#8220;year-month-day&#8221;
information to create a timeseries plot...</li>
<li>So I&#8217;ll resort to a static figure creating using Seaborn</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># --- add period info ---</span>
<span class="n">display</span><span class="p">(</span><span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="c1">#ts_flightcounts.isnull().sum()</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">31</span><span class="p">),</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;period1&#39;</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">31</span><span class="p">),</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;period2&#39;</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">31</span><span class="p">),</span> <span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;period3&#39;</span>

<span class="n">display</span><span class="p">(</span><span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="k">assert</span> <span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>day</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>residual</th>
      <th>resid_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-11-01</th>
      <td>18215</td>
      <td>1</td>
      <td>11</td>
      <td>Fri</td>
      <td>1699.554140</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013-11-02</th>
      <td>13813</td>
      <td>2</td>
      <td>11</td>
      <td>Sat</td>
      <td>404.471338</td>
      <td>1295.082803</td>
    </tr>
    <tr>
      <th>2013-11-03</th>
      <td>17031</td>
      <td>3</td>
      <td>11</td>
      <td>Sun</td>
      <td>1426.910828</td>
      <td>-1022.439490</td>
    </tr>
    <tr>
      <th>2013-11-04</th>
      <td>18039</td>
      <td>4</td>
      <td>11</td>
      <td>Mon</td>
      <td>1508.917197</td>
      <td>-82.006369</td>
    </tr>
    <tr>
      <th>2013-11-05</th>
      <td>17259</td>
      <td>5</td>
      <td>11</td>
      <td>Tue</td>
      <td>1139.108974</td>
      <td>369.808223</td>
    </tr>
  </tbody>
</table>
</div><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>day</th>
      <th>month</th>
      <th>day_of_week</th>
      <th>residual</th>
      <th>resid_lag</th>
      <th>period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-11-01</th>
      <td>18215</td>
      <td>1</td>
      <td>11</td>
      <td>Fri</td>
      <td>1699.554140</td>
      <td>NaN</td>
      <td>period1</td>
    </tr>
    <tr>
      <th>2013-11-02</th>
      <td>13813</td>
      <td>2</td>
      <td>11</td>
      <td>Sat</td>
      <td>404.471338</td>
      <td>1295.082803</td>
      <td>period1</td>
    </tr>
    <tr>
      <th>2013-11-03</th>
      <td>17031</td>
      <td>3</td>
      <td>11</td>
      <td>Sun</td>
      <td>1426.910828</td>
      <td>-1022.439490</td>
      <td>period1</td>
    </tr>
    <tr>
      <th>2013-11-04</th>
      <td>18039</td>
      <td>4</td>
      <td>11</td>
      <td>Mon</td>
      <td>1508.917197</td>
      <td>-82.006369</td>
      <td>period1</td>
    </tr>
    <tr>
      <th>2013-11-05</th>
      <td>17259</td>
      <td>5</td>
      <td>11</td>
      <td>Tue</td>
      <td>1139.108974</td>
      <td>369.808223</td>
      <td>period1</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1">#http://stackoverflow.com/questions/37596714/compare-multiple-year-data-on-a-single-plot-python</span>
<span class="c1">#http://man7.org/linux/man-pages/man3/strftime.3.html</span>
<span class="n">ts_flightcounts</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">sns_figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;period == &quot;period1&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;(2013/11 to 2014/10)&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;period == &quot;period2&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;(2014/11 to 2015/10)&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;period == &quot;period3&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;(2015/11 to 2016/10)&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Daily Airflight Counts in the US over 3 different annual periods&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0xc1824828&gt;
</pre></div>
</div>
<img alt="_images/regressing_out_weekday_effect_43_1.png" src="_images/regressing_out_weekday_effect_43_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">sns_figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;period == &quot;period1&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;(2013/11 to 2014/10)&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;period == &quot;period2&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;(2014/11 to 2015/10)&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ts_flightcounts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;period == &quot;period3&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;resid_lag&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;(2015/11 to 2016/10)&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lagged residual plots in the Airflight Counts in the US over 3 different annual periods&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0xf37d45c0&gt;
</pre></div>
</div>
<img alt="_images/regressing_out_weekday_effect_43_1.png" src="_images/regressing_out_weekday_effect_43_1.png" />
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/regressing_out_weekday_effect.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
      Last updated on Jan 12, 2017.<br/>
    </p>
  </div>
</footer>
  </body>
</html>