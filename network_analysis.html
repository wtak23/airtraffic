


<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Part3: Network analysis of 2016 US Air Traffic</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/font-awesome-4.7.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="" href="index.html" />
    <link rel="next" title="Other Data munging (elbow grease required!)" href="data_munging.html" />
    <link rel="prev" title="Part 2: Regressing out the effect of “day_of_wek”" href="regressing_out_weekday_effect.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          US Airport Traffic Analysis</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://takwatanabe.me/resume.pdf"><i class="fa fa-spotify" aria-hidden="true"></i>&nbsp; resume</a></li>
                <li><a href="https://github.com/wtak23/airtraffic"><i class="fa fa-github" aria-hidden="true"></i>&nbsp; Codes</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Project Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#galleries">Galleries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis-gallery.html">Gallery 1: Trend in US air-traffic movement</a></li>
<li class="toctree-l3"><a class="reference internal" href="regression-gallery.html">Gallery 2: Air-traffic Residual Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="network-analysis-gallery.html">Gallery 3: Network Theoretic Analysis of US Airtraffic (my favorite)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flight-count-analysis.html">Part 1. Air-traffic Count Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#goal-of-this-analysis">Goal of this analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#load-and-explore-dataset">Load and explore dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#enhanced-lookup-table">Enhanced lookup table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#create-timeseries-of-daily-flight-counts">Create Timeseries of Daily Flight Counts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#create-interactive-plot-with-plotly-cufflinks">Create interactive plot with plotly/cufflinks</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#study-seasonal-trend-with-rolling-averaged-timeseries">Study seasonal trend with rolling-averaged timeseries</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#narrow-focus-on-honolulu-airport">Narrow focus on Honolulu Airport</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#flight-counts-study-by-day-of-week-and-month">Flight counts study by &#8220;day_of_week&#8221; and &#8220;month&#8221;</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#over-entire-year-period">Over entire year period</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#pivoting-analysis-grouped-by-month-and-day-of-week">Pivoting: analysis grouped by month and day_of_week</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#repeat-analysis-for-ny-la-and-vegas">Repeat analysis for NY, LA, and Vegas.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#data-tidying">Data tidying</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#plot-results">Plot results</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#create-sublots-of-monthly-flight-count-trends-for-each-city">Create sublots of monthly flight-count trends for each city</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#which-state-had-the-most-air-traffics">Which state had the most air traffics?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#id1">Data tidying</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#choropleth-figure-display-result-on-us-map">Choropleth figure (display result on US map)</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#choropleth-after-normalizing-over-state-population">Choropleth after normalizing over state population</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#ignore-nothing-interesting">(ignore, nothing interesting)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flight-count-analysis.html#most-frequently-used-airports">Most frequently used airports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#id2">Data tidying</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#id3">Plot results</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#display-results-on-us-map">Display results on US Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-count-analysis.html#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="regressing_out_weekday_effect.html">Part 2: Regressing out the effect of &#8220;day_of_wek&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="regressing_out_weekday_effect.html#goal-of-this-notebook">Goal of this notebook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="regressing_out_weekday_effect.html#load-data-and-prepare-timeseries">Load data, and prepare Timeseries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="regressing_out_weekday_effect.html#regression-analysis-eliminate-effect-from-day-of-week">Regression analysis: eliminate effect from &#8220;day_of_week&#8221;</a><ul>
<li class="toctree-l3"><a class="reference internal" href="regressing_out_weekday_effect.html#fit-ols-model">Fit OLS model</a></li>
<li class="toctree-l3"><a class="reference internal" href="regressing_out_weekday_effect.html#analyze-residual-signal">Analyze residual signal</a></li>
<li class="toctree-l3"><a class="reference internal" href="regressing_out_weekday_effect.html#compute-first-order-difference-in-the-residual">Compute first-order difference in the residual</a></li>
<li class="toctree-l3"><a class="reference internal" href="regressing_out_weekday_effect.html#histograms-of-the-signals">Histograms of the signals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="regressing_out_weekday_effect.html#repeat-analysis-for-3-years-period">Repeat analysis for 3 years period</a><ul>
<li class="toctree-l3"><a class="reference internal" href="regressing_out_weekday_effect.html#try-overlaying-the-annual-plot">Try overlaying the annual plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="regressing_out_weekday_effect.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Part3: Network analysis of 2016 US Air Traffic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview-network-view-of-the-us-airtraffic-system">Overview: network view of the US Airtraffic System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#outline-of-the-analysis">Outline of the analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-directed-graph-trips">Create directed graph: <strong>trips</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-tidying">Data tidying</a></li>
<li class="toctree-l3"><a class="reference internal" href="#most-frequent-trips-in-us-during-the-past-year">Most frequent &#8220;trips&#8221; in US during the past year</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-undirected-graph-edges-ignoring-directionality">Create undirected graph &#8211; edges ignoring directionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Data tidying</a></li>
<li class="toctree-l3"><a class="reference internal" href="#most-frequent-routes-in-us-during-the-past-year">Most frequent &#8220;routes&#8221; in US during the past year</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#only-codes-can-be-skipped-define-helper-functions-for-complex-network-analysis">(only codes, can be skipped) Define helper functions for complex network analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#make-nx-graph-create-networkx-graph-object">make_nx_graph: create networkx graph object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-network-measures-network-measures-characterizing-nodes-airport">compute_network_measures: network measures characterizing nodes (airport)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-helper-functions">Other helper functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#complex-network-theory-in-action">Complex network theory in action!</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#power-law-analysis-of-centrality-measures">Power law analysis of centrality measures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pagerank-centrality-among-us-airports">PageRank Centrality among US Airports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#communities-detected-via-modularity-score">Communities Detected via Modularity Score</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-the-airtraffics-in-gephi">Visualizing the airtraffics in Gephi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_munging.html">Other Data munging (elbow grease required!)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="create_lookup_table.html">Create lookup-table</a><ul>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#aim-of-notebook">Aim of notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#load-the-main-airport-traffic-data">Load the main airport traffic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#load-lookup-table-provided-by-bts">Load lookup table provided by BTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#create-enhanced-lookuptable">Create <em>enhanced</em> lookuptable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#remove-code-that-is-not-present-our-dataset">Remove Code that is not present our dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#parse-state-city-and-airport-name-from-description-field">Parse state,city, and airport-name from &#8216;Description&#8217; field</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#add-state-region-information">Add state &#8216;region&#8217; information</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#add-airport-latitude-and-longitude-information-using-geocoder">Add airport latitude and longitude information using geocoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="create_lookup_table.html#add-column-with-both-city-and-state">Add column with both city and state</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="create_lookup_table.html#all-done-save-dataframe-on-disk">All done. Save dataframe on disk</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="webscrape_beautifulsoup.html">BeautifulSoup to extract US State population</a></li>
<li class="toctree-l2"><a class="reference internal" href="carriers_airports.html">Study <code class="docutils literal"><span class="pre">carriers.xls</span></code> and <code class="docutils literal"><span class="pre">airports</span> <span class="pre">new.xlt</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="carriers_airports.html#study-the-carrier-spreadsheet">Study the &#8220;carrier&#8221; spreadsheet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#sort-out-the-nan-values">sort out the &#8220;nan&#8221; values</a></li>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#filter-away-nans-from-the-dataframe">Filter away nans from the DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#realized-some-code-is-treated-as-int-convert-to-string">Realized some <em>Code</em> is treated as int...convert to string</a></li>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#what-s-the-deal-with-the-1-appended-to-some-of-the-entries">What&#8217;s the deal with the (1) appended to some of the entries?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="carriers_airports.html#study-airports-spreadsheet">Study <em>airports</em> spreadsheet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#study-nans">Study nans</a></li>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#filter-out-non-usa-airports">Filter out non-USA airports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="carriers_airports.html#study-airports-state-distribution">Study &#8220;airports&#8221; state distribution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#plot-bubble-markers-for-all-airports">Plot bubble markers for all airports</a></li>
<li class="toctree-l4"><a class="reference internal" href="carriers_airports.html#take-a-closer-look-at-michigan-my-home-state">Take a closer look at Michigan, my home state</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Test SVG and png figures</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">page-contents <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Part3: Network analysis of 2016 US Air Traffic</a><ul>
<li><a class="reference internal" href="#overview-network-view-of-the-us-airtraffic-system">Overview: network view of the US Airtraffic System</a><ul>
<li><a class="reference internal" href="#outline-of-the-analysis">Outline of the analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-directed-graph-trips">Create directed graph: <strong>trips</strong></a><ul>
<li><a class="reference internal" href="#data-tidying">Data tidying</a></li>
<li><a class="reference internal" href="#most-frequent-trips-in-us-during-the-past-year">Most frequent &#8220;trips&#8221; in US during the past year</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-undirected-graph-edges-ignoring-directionality">Create undirected graph &#8211; edges ignoring directionality</a><ul>
<li><a class="reference internal" href="#id1">Data tidying</a></li>
<li><a class="reference internal" href="#most-frequent-routes-in-us-during-the-past-year">Most frequent &#8220;routes&#8221; in US during the past year</a></li>
</ul>
</li>
<li><a class="reference internal" href="#only-codes-can-be-skipped-define-helper-functions-for-complex-network-analysis">(only codes, can be skipped) Define helper functions for complex network analysis</a><ul>
<li><a class="reference internal" href="#make-nx-graph-create-networkx-graph-object">make_nx_graph: create networkx graph object</a></li>
<li><a class="reference internal" href="#compute-network-measures-network-measures-characterizing-nodes-airport">compute_network_measures: network measures characterizing nodes (airport)</a></li>
<li><a class="reference internal" href="#other-helper-functions">Other helper functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-network-theory-in-action">Complex network theory in action!</a><ul>
<li><a class="reference internal" href="#power-law-analysis-of-centrality-measures">Power law analysis of centrality measures</a></li>
<li><a class="reference internal" href="#pagerank-centrality-among-us-airports">PageRank Centrality among US Airports</a></li>
<li><a class="reference internal" href="#communities-detected-via-modularity-score">Communities Detected via Modularity Score</a></li>
<li><a class="reference internal" href="#visualizing-the-airtraffics-in-gephi">Visualizing the airtraffics in Gephi</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="part3-network-analysis-of-2016-us-air-traffic">
<h1>Part3: Network analysis of 2016 US Air Traffic</h1>
<p>The original Jupyter notebook can be downloaded from <a class="reference external" href="http://nbviewer.jupyter.org/github/wtak23/airtraffic/blob/master/final_scripts/network_analysis.ipynb">here</a> .</p>
<div class="contents local topic" id="page-contents">
<p class="topic-title first"><cite>Page Contents</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#overview-network-view-of-the-us-airtraffic-system" id="id2">Overview: network view of the US Airtraffic System</a><ul>
<li><a class="reference internal" href="#outline-of-the-analysis" id="id3">Outline of the analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-directed-graph-trips" id="id4">Create directed graph: <strong>trips</strong></a><ul>
<li><a class="reference internal" href="#data-tidying" id="id5">Data tidying</a></li>
<li><a class="reference internal" href="#most-frequent-trips-in-us-during-the-past-year" id="id6">Most frequent &#8220;trips&#8221; in US during the past year</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-undirected-graph-edges-ignoring-directionality" id="id7">Create undirected graph &#8211; edges ignoring directionality</a><ul>
<li><a class="reference internal" href="#id1" id="id8">Data tidying</a></li>
<li><a class="reference internal" href="#most-frequent-routes-in-us-during-the-past-year" id="id9">Most frequent &#8220;routes&#8221; in US during the past year</a></li>
</ul>
</li>
<li><a class="reference internal" href="#only-codes-can-be-skipped-define-helper-functions-for-complex-network-analysis" id="id10">(only codes, can be skipped) Define helper functions for complex network analysis</a><ul>
<li><a class="reference internal" href="#make-nx-graph-create-networkx-graph-object" id="id11">make_nx_graph: create networkx graph object</a></li>
<li><a class="reference internal" href="#compute-network-measures-network-measures-characterizing-nodes-airport" id="id12">compute_network_measures: network measures characterizing nodes (airport)</a></li>
<li><a class="reference internal" href="#other-helper-functions" id="id13">Other helper functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-network-theory-in-action" id="id14">Complex network theory in action!</a><ul>
<li><a class="reference internal" href="#power-law-analysis-of-centrality-measures" id="id15">Power law analysis of centrality measures</a></li>
<li><a class="reference internal" href="#pagerank-centrality-among-us-airports" id="id16">PageRank Centrality among US Airports</a></li>
<li><a class="reference internal" href="#communities-detected-via-modularity-score" id="id17">Communities Detected via Modularity Score</a></li>
<li><a class="reference internal" href="#visualizing-the-airtraffics-in-gephi" id="id18">Visualizing the airtraffics in Gephi</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id19">Conclusion</a></li>
</ul>
</div>
<div class="section" id="overview-network-view-of-the-us-airtraffic-system">
<h2><a class="toc-backref" href="#id2">Overview: network view of the US Airtraffic System</a></h2>
<ul class="simple">
<li>In this final part of the project, we&#8217;ll view the US Airline system
as a large network (graph) system consisting of nodes (airports)
whose interactions/connections are described by edges (flights
between airports).</li>
<li>More precisely, we will view the airport graph as a <a class="reference external" href="https://en.wikipedia.org/wiki/Complex_network">complex
network</a> system,
which exhibits non-trivial topology that are absent in random graphs
(such as hub nodes with high degre of centrality)</li>
<li>Complex network is a heavily researched field, and we fortunately
have access to rich set of both theoretical and practical tools</li>
<li>tools I will relying on for this work:</li>
<li><a class="reference external" href="networkx.readthedocs.org/en/networkx-1.11/">NetworkX</a> and <a class="reference external" href="https://sites.google.com/site/bctnet/">Brain
Connectivity Toolbox</a> for
computing collections of <a class="reference external" href="https://arxiv.org/pdf/cond-mat/0505185v5.pdf">**complex network
measures**</a> that
characterizes the topological struture of the network</li>
<li><a class="reference external" href="https://gephi.org/">Gephi</a> for visualizing the graph data saved
as a <code class="docutils literal"><span class="pre">.gexf</span></code> file</li>
</ul>
<p>This part of the analysis was by far mar favorite part!</p>
<div class="section" id="outline-of-the-analysis">
<h3><a class="toc-backref" href="#id3">Outline of the analysis</a></h3>
<ul class="simple">
<li>we&#8217;ll again begin by <strong>tidying</strong> the US passenger travel data into a
graph structure</li>
<li>For any airport pair, say <code class="docutils literal"><span class="pre">A</span></code> and <code class="docutils literal"><span class="pre">B</span></code>, we&#8217;ll measure the <strong>edge</strong>
in two ways:</li>
</ul>
<ol class="arabic simple">
<li><strong>trips</strong>: <code class="docutils literal"><span class="pre">A</span> <span class="pre">-&gt;</span> <span class="pre">B</span></code> is distinguished from <code class="docutils literal"><span class="pre">B</span> <span class="pre">-&gt;</span> <span class="pre">A</span></code>;
directionality matters here (<strong>directed graph</strong>)</li>
<li><strong>routes</strong>: <code class="docutils literal"><span class="pre">A</span> <span class="pre">-&gt;</span> <span class="pre">B</span></code> and <code class="docutils literal"><span class="pre">B</span> <span class="pre">-&gt;</span> <span class="pre">A</span></code> are not distuishable, so both
landings and take-offs are counted; (<strong>undirected graph</strong>)</li>
</ol>
<ul class="simple">
<li>once we have the normalized data, we&#8217;ll first identify the pairs of
airports with the largest edge values</li>
<li>we will then compute a collection of key network measures that
characterizes the topologicla property of the US air-traffic system,
such as the level of centrality/important of an airport, as well as
the <strong>community structure</strong> formed among the US airports (ie, set of
airports that tend to be tightly connected with each other)</li>
</ul>
<p>The remainder of the section loads the dataset in the exact same way as
part1 and 2.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>%matplotlib inline
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly</span>
<span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="kn">as</span> <span class="nn">py</span>

<span class="c1"># libraries for network analysis</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">bct</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="kn">import</span> <span class="nn">cufflinks</span> <span class="kn">as</span> <span class="nn">cf</span>
<span class="n">cf</span><span class="o">.</span><span class="n">set_config_file</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="s1">&#39;ggplot&#39;</span><span class="p">,</span><span class="n">sharing</span><span class="o">=</span><span class="s1">&#39;secret&#39;</span><span class="p">)</span>

<span class="c1"># utility functions for this project</span>
<span class="c1"># see https://github.com/wtak23/airtraffic/blob/master/final_scripts/util/util.py</span>
<span class="kn">import</span> <span class="nn">util</span>

<span class="c1"># limit output to avoid cluttering screen</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">period</span> <span class="o">=</span> <span class="s1">&#39;11/1/2015 to 10/31/2016&#39;</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;network_analysis&#39;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">load_airport_data</span><span class="p">()</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span> <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">11.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2015</span><span class="o">-</span><span class="mf">12.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">01.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">02.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">03.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">04.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">05.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">06.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">07.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">08.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">09.</span><span class="n">zip</span>
 <span class="o">...</span> <span class="n">load</span> <span class="n">dataframe</span> <span class="kn">from</span> <span class="mi">2016</span><span class="o">-</span><span class="mf">10.</span><span class="n">zip</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YEAR</th>
      <th>QUARTER</th>
      <th>MONTH</th>
      <th>DAY_OF_MONTH</th>
      <th>DAY_OF_WEEK</th>
      <th>ORIGIN_AIRPORT_ID</th>
      <th>DEST_AIRPORT_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>4</td>
      <td>3</td>
      <td>14570</td>
      <td>13930</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>5</td>
      <td>4</td>
      <td>13930</td>
      <td>14057</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>6</td>
      <td>5</td>
      <td>13930</td>
      <td>14057</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>7</td>
      <td>6</td>
      <td>13930</td>
      <td>14057</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>8</td>
      <td>7</td>
      <td>13930</td>
      <td>14057</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">df_lookup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;df_lookup.csv&#39;</span><span class="p">)</span> <span class="c1"># lookup table for the AIRPORT_ID above</span>

<span class="n">display</span><span class="p">(</span><span class="n">df_lookup</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Code</th>
      <th>Description</th>
      <th>Airport</th>
      <th>City</th>
      <th>State</th>
      <th>Region</th>
      <th>lat</th>
      <th>lon</th>
      <th>City_State</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10135</td>
      <td>Allentown/Bethlehem/Easton, PA: Lehigh Valley ...</td>
      <td>Lehigh Valley International</td>
      <td>Allentown/Bethlehem/Easton</td>
      <td>PA</td>
      <td>Northeast</td>
      <td>40.651650</td>
      <td>-75.434746</td>
      <td>Allentown/Bethlehem/Easton (PA)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10136</td>
      <td>Abilene, TX: Abilene Regional</td>
      <td>Abilene Regional</td>
      <td>Abilene</td>
      <td>TX</td>
      <td>South</td>
      <td>32.448736</td>
      <td>-99.733144</td>
      <td>Abilene (TX)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10140</td>
      <td>Albuquerque, NM: Albuquerque International Sun...</td>
      <td>Albuquerque International Sunport</td>
      <td>Albuquerque</td>
      <td>NM</td>
      <td>West</td>
      <td>35.043333</td>
      <td>-106.612909</td>
      <td>Albuquerque (NM)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10141</td>
      <td>Aberdeen, SD: Aberdeen Regional</td>
      <td>Aberdeen Regional</td>
      <td>Aberdeen</td>
      <td>SD</td>
      <td>Midwest</td>
      <td>45.453458</td>
      <td>-98.417726</td>
      <td>Aberdeen (SD)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10146</td>
      <td>Albany, GA: Southwest Georgia Regional</td>
      <td>Southwest Georgia Regional</td>
      <td>Albany</td>
      <td>GA</td>
      <td>South</td>
      <td>31.535671</td>
      <td>-84.193905</td>
      <td>Albany (GA)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="create-directed-graph-trips">
<h2><a class="toc-backref" href="#id4">Create directed graph: <strong>trips</strong></a></h2>
<ul class="simple">
<li>we first define a directed graph, where flights <code class="docutils literal"><span class="pre">A-&gt;B</span></code> is
distinguished from <code class="docutils literal"><span class="pre">B-A</span></code></li>
<li>I&#8217;ll refer to these edges as <code class="docutils literal"><span class="pre">trips</span></code></li>
</ul>
<div class="section" id="data-tidying">
<h3><a class="toc-backref" href="#id5">Data tidying</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create a new column containing the *origin* and the *destination* airport</span>
<span class="c1"># (these will form the network &quot;edges&quot; in our graph, with airport being the nodes)</span>
<span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;Trips&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;ORIGIN_AIRPORT_ID&#39;</span><span class="p">],</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;DEST_AIRPORT_ID&#39;</span><span class="p">]))</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YEAR</th>
      <th>QUARTER</th>
      <th>MONTH</th>
      <th>DAY_OF_MONTH</th>
      <th>DAY_OF_WEEK</th>
      <th>ORIGIN_AIRPORT_ID</th>
      <th>DEST_AIRPORT_ID</th>
      <th>Trips</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>4</td>
      <td>3</td>
      <td>14570</td>
      <td>13930</td>
      <td>(14570, 13930)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>5</td>
      <td>4</td>
      <td>13930</td>
      <td>14057</td>
      <td>(13930, 14057)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>6</td>
      <td>5</td>
      <td>13930</td>
      <td>14057</td>
      <td>(13930, 14057)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>7</td>
      <td>6</td>
      <td>13930</td>
      <td>14057</td>
      <td>(13930, 14057)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015</td>
      <td>4</td>
      <td>11</td>
      <td>8</td>
      <td>7</td>
      <td>13930</td>
      <td>14057</td>
      <td>(13930, 14057)</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create table of &quot;trip_counts&quot; (sorted by most frequent trips)</span>
<span class="n">trip_counts</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;Trips&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="n">trip_counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(14771, 12892)</th>
      <td>17757</td>
    </tr>
    <tr>
      <th>(12892, 14771)</th>
      <td>17409</td>
    </tr>
    <tr>
      <th>(12892, 12478)</th>
      <td>12463</td>
    </tr>
    <tr>
      <th>(12478, 12892)</th>
      <td>12461</td>
    </tr>
    <tr>
      <th>(12892, 12889)</th>
      <td>11317</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create two columns for the pair of nodes forming the edge</span>
<span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">trip_counts</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">trip_counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>code1</th>
      <th>code2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17757</td>
      <td>14771</td>
      <td>12892</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17409</td>
      <td>12892</td>
      <td>14771</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12463</td>
      <td>12892</td>
      <td>12478</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12461</td>
      <td>12478</td>
      <td>12892</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11317</td>
      <td>12892</td>
      <td>12889</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create columns with corresponding airport information</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">u&#39;Airport&#39;</span><span class="p">,</span> <span class="s1">u&#39;City&#39;</span><span class="p">,</span><span class="s1">u&#39;State&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
    <span class="c1"># create hash-table for ID lookup</span>
    <span class="n">hash_table</span> <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="n">trip_counts</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">hash_table</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>
    <span class="n">trip_counts</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">hash_table</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>

<span class="c1"># reorder columns (just personal preference)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">cols</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">trip_counts</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">trip_counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17757</td>
      <td>San Francisco International</td>
      <td>Los Angeles International</td>
      <td>San Francisco</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>CA</td>
      <td>14771</td>
      <td>12892</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17409</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12463</td>
      <td>Los Angeles International</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles</td>
      <td>New York</td>
      <td>CA</td>
      <td>NY</td>
      <td>12892</td>
      <td>12478</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12461</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11317</td>
      <td>Los Angeles International</td>
      <td>McCarran International</td>
      <td>Los Angeles</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>12892</td>
      <td>12889</td>
    </tr>
  </tbody>
</table>
</div><ul class="simple">
<li>add distance associated with each trips (ie, distance between aiports
in kilometers)</li>
<li>to do this, we convert the pairs of lat/lon into distance using
<a class="reference external" href="https://en.wikipedia.org/wiki/Vincenty's_formulae">Vincent&#8217;s
formula</a></li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># add distance associated with each trips (ie, distance between aiports)</span>
<span class="c1"># see https://en.wikipedia.org/wiki/Vincenty&#39;s_formulae</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">vincenty</span>
<span class="n">dist_</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">hash_lat</span> <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">hash_lon</span> <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">code1</span><span class="p">,</span><span class="n">code2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">],</span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code2&#39;</span><span class="p">]):</span>
    <span class="n">coord1</span> <span class="o">=</span> <span class="n">hash_lat</span><span class="p">[</span><span class="n">code1</span><span class="p">],</span><span class="n">hash_lon</span><span class="p">[</span><span class="n">code1</span><span class="p">]</span>
    <span class="n">coord2</span> <span class="o">=</span> <span class="n">hash_lat</span><span class="p">[</span><span class="n">code2</span><span class="p">],</span><span class="n">hash_lon</span><span class="p">[</span><span class="n">code2</span><span class="p">]</span>
    <span class="n">dist_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vincenty</span><span class="p">(</span><span class="n">coord1</span><span class="p">,</span><span class="n">coord2</span><span class="p">)</span><span class="o">.</span><span class="n">kilometers</span><span class="p">)</span>

<span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_</span>
<span class="n">trip_counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17757</td>
      <td>San Francisco International</td>
      <td>Los Angeles International</td>
      <td>San Francisco</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>CA</td>
      <td>14771</td>
      <td>12892</td>
      <td>543.531637</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17409</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12463</td>
      <td>Los Angeles International</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles</td>
      <td>New York</td>
      <td>CA</td>
      <td>NY</td>
      <td>12892</td>
      <td>12478</td>
      <td>3983.079400</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12461</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11317</td>
      <td>Los Angeles International</td>
      <td>McCarran International</td>
      <td>Los Angeles</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>12892</td>
      <td>12889</td>
      <td>380.413047</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="most-frequent-trips-in-us-during-the-past-year">
<h3><a class="toc-backref" href="#id6">Most frequent &#8220;trips&#8221; in US during the past year</a></h3>
<ul class="simple">
<li>now that we have an appropriate table, let&#8217;s start exploring which
trip (pair of airports) took place the most during Nov-1-2015 to
Oct-31-2016</li>
<li>let&#8217;s first see the top 10 trips</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s2">&quot;{} unique trips made&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trip_counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s1">&#39; the top 10 flights during {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
<span class="n">trip_counts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>4637 unique trips made
============== the top 10 flights during 11/1/2015 to 10/31/2016 ===============
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17757</td>
      <td>San Francisco International</td>
      <td>Los Angeles International</td>
      <td>San Francisco</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>CA</td>
      <td>14771</td>
      <td>12892</td>
      <td>543.531637</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17409</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12463</td>
      <td>Los Angeles International</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles</td>
      <td>New York</td>
      <td>CA</td>
      <td>NY</td>
      <td>12892</td>
      <td>12478</td>
      <td>3983.079400</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12461</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11317</td>
      <td>Los Angeles International</td>
      <td>McCarran International</td>
      <td>Los Angeles</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>12892</td>
      <td>12889</td>
      <td>380.413047</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11298</td>
      <td>McCarran International</td>
      <td>Los Angeles International</td>
      <td>Las Vegas</td>
      <td>Los Angeles</td>
      <td>NV</td>
      <td>CA</td>
      <td>12889</td>
      <td>12892</td>
      <td>380.413047</td>
    </tr>
    <tr>
      <th>6</th>
      <td>10245</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles International</td>
      <td>Seattle</td>
      <td>Los Angeles</td>
      <td>WA</td>
      <td>CA</td>
      <td>14747</td>
      <td>12892</td>
      <td>1535.379400</td>
    </tr>
    <tr>
      <th>7</th>
      <td>10224</td>
      <td>Los Angeles International</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles</td>
      <td>Seattle</td>
      <td>CA</td>
      <td>WA</td>
      <td>12892</td>
      <td>14747</td>
      <td>1535.379400</td>
    </tr>
    <tr>
      <th>8</th>
      <td>10057</td>
      <td>LaGuardia</td>
      <td>Chicago O'Hare International</td>
      <td>New York</td>
      <td>Chicago</td>
      <td>NY</td>
      <td>IL</td>
      <td>12953</td>
      <td>13930</td>
      <td>1180.129320</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9954</td>
      <td>Chicago O'Hare International</td>
      <td>LaGuardia</td>
      <td>Chicago</td>
      <td>New York</td>
      <td>IL</td>
      <td>NY</td>
      <td>13930</td>
      <td>12953</td>
      <td>1180.129320</td>
    </tr>
  </tbody>
</table>
</div><ul class="simple">
<li>the top trips comes in pair....which makes sense, as most flights are
&#8220;round-trips&#8221;</li>
<li>For instance, <strong>SF to LA</strong> (17757 flights) and <strong>LA to SF</strong> (17409
flights) were the most frequent made trip.</li>
<li>As these values are very close, it&#8217;s reasonable to believe most of
the flights were <strong>round trips</strong></li>
<li>(the small difference in flight-counts can be due to missed flight,
permanent relocation, etc)</li>
</ul>
<p>Let&#8217;s next plot the top 500 <code class="docutils literal"><span class="pre">trips</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># create hover-text object for plotly</span>
<span class="k">def</span> <span class="nf">string_rank</span><span class="p">(</span><span class="n">ranking</span><span class="p">):</span>
    <span class="n">headstr</span> <span class="o">=</span> <span class="s1">&#39;Ranking: &#39;</span>
    <span class="k">if</span> <span class="n">ranking</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="s1">&#39;1st&#39;</span>
    <span class="k">elif</span> <span class="n">ranking</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="s1">&#39;2nd&#39;</span>
    <span class="k">elif</span> <span class="n">ranking</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="s1">&#39;3rd&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ranking</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;th&#39;</span>

<span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;Airport1&#39;</span><span class="p">]</span>
              <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;Airport2&#39;</span><span class="p">]</span>
              <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;City1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;State1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
              <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;City2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;State2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
              <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;Number of flight: &#39;</span> <span class="o">+</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>

<span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="nb">map</span><span class="p">(</span><span class="n">string_rank</span><span class="p">,</span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c1"># trip_counts.iplot(kind=&#39;bar&#39;,columns=[&#39;counts&#39;],text=&#39;text&#39;,filename=&#39;test&#39;,x=trip_counts.index.bool())</span>



<span class="c1"># # plot top_k</span>
<span class="n">top_k</span> <span class="o">=</span> <span class="mi">250</span>

<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Most frequent flights made in the US airports between {} (directions considered)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_k</span><span class="p">,</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(hover over plots for the pairs of takeoff/landing airports; left-click to pan-zoom)&#39;</span>
<span class="n">trip_counts</span><span class="p">[:</span><span class="n">top_k</span><span class="p">]</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="c1"># &lt;- ranking info</span>
                          <span class="n">text</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="n">xTitle</span><span class="o">=</span><span class="s1">&#39;edge-ranking&#39;</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                          <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;topk_trip&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1949.embed?link=false&logo=false&share_key=DGLvImGRtSipSJVEfFEkWN" height="525px" width="100%"></iframe></div>
</div>
<div class="section" id="create-undirected-graph-edges-ignoring-directionality">
<h2><a class="toc-backref" href="#id7">Create undirected graph &#8211; edges ignoring directionality</a></h2>
<ul class="simple">
<li>In our next analysis, we&#8217;ll drop <strong>directionality</strong> in our analysis</li>
<li>That is, for any given trip (edge), we&#8217;ll ignoring which airport was
used for <strong>take-off</strong> or <strong>landing</strong></li>
<li>So the airport pair (SF,LA) will form an <strong>undirected edge</strong> with a
value of 17757+17409 = 35166</li>
<li>To create an undirected graph, .we do the following:</li>
<li>For any airport pair <code class="docutils literal"><span class="pre">A,B</span></code>, we identify the directed edges
<code class="docutils literal"><span class="pre">(A</span> <span class="pre">-&gt;</span> <span class="pre">B)</span></code> and <code class="docutils literal"><span class="pre">(A</span> <span class="pre">&lt;-</span> <span class="pre">B)</span></code></li>
<li>The resulting undirected edge <code class="docutils literal"><span class="pre">(A</span> <span class="pre">&lt;-&gt;</span> <span class="pre">B)</span></code> will have the value
<code class="docutils literal"><span class="pre">(A</span> <span class="pre">-&gt;</span> <span class="pre">B)</span> <span class="pre">+</span> <span class="pre">(A</span> <span class="pre">&lt;-</span> <span class="pre">B)</span></code></li>
</ul>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id8">Data tidying</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">trip_counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17757</td>
      <td>San Francisco International</td>
      <td>Los Angeles International</td>
      <td>San Francisco</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>CA</td>
      <td>14771</td>
      <td>12892</td>
      <td>543.531637</td>
      <td>San Francisco International to Los Angeles Int...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17409</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
      <td>Los Angeles International to San Francisco Int...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12463</td>
      <td>Los Angeles International</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles</td>
      <td>New York</td>
      <td>CA</td>
      <td>NY</td>
      <td>12892</td>
      <td>12478</td>
      <td>3983.079400</td>
      <td>Los Angeles International to John F. Kennedy I...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12461</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
      <td>John F. Kennedy International to Los Angeles I...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11317</td>
      <td>Los Angeles International</td>
      <td>McCarran International</td>
      <td>Los Angeles</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>12892</td>
      <td>12889</td>
      <td>380.413047</td>
      <td>Los Angeles International to McCarran Internat...</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">pair</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="p">),</span>
                     <span class="nb">zip</span><span class="p">(</span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">],</span><span class="n">trip_counts</span><span class="p">[</span><span class="s1">&#39;code2&#39;</span><span class="p">])))</span>

<span class="k">print</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

<span class="c1"># detect flights A-&gt;B and A&lt;-B (flights sharing same pair of airport)</span>
<span class="n">mask_AB</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="c1"># edges A -&gt; B</span>
<span class="n">mask_BA</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>  <span class="c1"># edges B -&gt; A</span>
<span class="n">mask_</span>    <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">mask_AB</span><span class="o">|</span><span class="n">mask_BA</span><span class="p">)</span>         <span class="c1"># some trips only have one direction</span>

<span class="k">assert</span> <span class="n">mask_AB</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">mask_BA</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">trip_counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">mask_AB</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">mask_BA</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">mask_</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">trips_AB</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="n">mask_AB</span><span class="p">]</span>
<span class="n">trips_BA</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="n">mask_BA</span><span class="p">]</span>
<span class="n">trip_neither</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span> <span class="o">~</span><span class="p">(</span><span class="n">mask_AB</span><span class="o">|</span><span class="n">mask_BA</span><span class="p">)]</span>

<span class="n">display</span><span class="p">(</span><span class="n">trips_AB</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">trips_BA</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">trip_neither</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>0    (12892, 14771)
1    (12892, 14771)
2    (12478, 12892)
3    (12478, 12892)
4    (12889, 12892)
5    (12889, 12892)
dtype: object
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>17409</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
      <td>Los Angeles International to San Francisco Int...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12461</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
      <td>John F. Kennedy International to Los Angeles I...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11298</td>
      <td>McCarran International</td>
      <td>Los Angeles International</td>
      <td>Las Vegas</td>
      <td>Los Angeles</td>
      <td>NV</td>
      <td>CA</td>
      <td>12889</td>
      <td>12892</td>
      <td>380.413047</td>
      <td>McCarran International to Los Angeles Internat...</td>
      <td>6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>10224</td>
      <td>Los Angeles International</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles</td>
      <td>Seattle</td>
      <td>CA</td>
      <td>WA</td>
      <td>12892</td>
      <td>14747</td>
      <td>1535.379400</td>
      <td>Los Angeles International to Seattle/Tacoma In...</td>
      <td>8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9954</td>
      <td>Chicago O'Hare International</td>
      <td>LaGuardia</td>
      <td>Chicago</td>
      <td>New York</td>
      <td>IL</td>
      <td>NY</td>
      <td>13930</td>
      <td>12953</td>
      <td>1180.129320</td>
      <td>Chicago O'Hare International to LaGuardia&lt;br&gt;C...</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17757</td>
      <td>San Francisco International</td>
      <td>Los Angeles International</td>
      <td>San Francisco</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>CA</td>
      <td>14771</td>
      <td>12892</td>
      <td>543.531637</td>
      <td>San Francisco International to Los Angeles Int...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12463</td>
      <td>Los Angeles International</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles</td>
      <td>New York</td>
      <td>CA</td>
      <td>NY</td>
      <td>12892</td>
      <td>12478</td>
      <td>3983.079400</td>
      <td>Los Angeles International to John F. Kennedy I...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11317</td>
      <td>Los Angeles International</td>
      <td>McCarran International</td>
      <td>Los Angeles</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>12892</td>
      <td>12889</td>
      <td>380.413047</td>
      <td>Los Angeles International to McCarran Internat...</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>10245</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles International</td>
      <td>Seattle</td>
      <td>Los Angeles</td>
      <td>WA</td>
      <td>CA</td>
      <td>14747</td>
      <td>12892</td>
      <td>1535.379400</td>
      <td>Seattle/Tacoma International to Los Angeles In...</td>
      <td>7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>10057</td>
      <td>LaGuardia</td>
      <td>Chicago O'Hare International</td>
      <td>New York</td>
      <td>Chicago</td>
      <td>NY</td>
      <td>IL</td>
      <td>12953</td>
      <td>13930</td>
      <td>1180.129320</td>
      <td>LaGuardia to Chicago O'Hare International&lt;br&gt;N...</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3241</th>
      <td>366</td>
      <td>Wiley Post/Will Rogers Memorial</td>
      <td>Fairbanks International</td>
      <td>Barrow</td>
      <td>Fairbanks</td>
      <td>AK</td>
      <td>AK</td>
      <td>10754</td>
      <td>11630</td>
      <td>809.595183</td>
      <td>Wiley Post/Will Rogers Memorial to Fairbanks I...</td>
      <td>3242</td>
    </tr>
    <tr>
      <th>3598</th>
      <td>263</td>
      <td>Devils Lake Regional</td>
      <td>Denver International</td>
      <td>Devils Lake</td>
      <td>Denver</td>
      <td>ND</td>
      <td>CO</td>
      <td>11447</td>
      <td>11292</td>
      <td>1028.249825</td>
      <td>Devils Lake Regional to Denver International&lt;b...</td>
      <td>3599</td>
    </tr>
    <tr>
      <th>3607</th>
      <td>261</td>
      <td>Hattiesburg-Laurel Regional</td>
      <td>Dallas/Fort Worth International</td>
      <td>Hattiesburg/Laurel</td>
      <td>Dallas/Fort Worth</td>
      <td>MS</td>
      <td>TX</td>
      <td>14109</td>
      <td>11298</td>
      <td>751.719146</td>
      <td>Hattiesburg-Laurel Regional to Dallas/Fort Wor...</td>
      <td>3608</td>
    </tr>
    <tr>
      <th>4344</th>
      <td>23</td>
      <td>Washington Dulles International</td>
      <td>San Antonio International</td>
      <td>Washington</td>
      <td>San Antonio</td>
      <td>DC</td>
      <td>TX</td>
      <td>12264</td>
      <td>14683</td>
      <td>2192.125251</td>
      <td>Washington Dulles International to San Antonio...</td>
      <td>4345</td>
    </tr>
    <tr>
      <th>4365</th>
      <td>16</td>
      <td>Joslin Field - Magic Valley Regional</td>
      <td>San Francisco International</td>
      <td>Twin Falls</td>
      <td>San Francisco</td>
      <td>ID</td>
      <td>CA</td>
      <td>15389</td>
      <td>14771</td>
      <td>862.579453</td>
      <td>Joslin Field - Magic Valley Regional to San Fr...</td>
      <td>4366</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">trips_AB</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="n">mask_AB</span><span class="p">]</span>
<span class="n">trips_BA</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span><span class="n">mask_BA</span><span class="p">]</span>
<span class="n">trip_neither</span> <span class="o">=</span> <span class="n">trip_counts</span><span class="p">[</span> <span class="o">~</span><span class="p">(</span><span class="n">mask_AB</span><span class="o">|</span><span class="n">mask_BA</span><span class="p">)]</span>

<span class="c1"># this will serve as our final undirected graph</span>
<span class="n">trip_counts_und</span> <span class="o">=</span> <span class="n">trips_AB</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># to identify matching rows, swap code1,code2</span>
<span class="n">trips_BA</span> <span class="o">=</span> <span class="n">trips_BA</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;code1&#39;</span><span class="p">:</span><span class="s1">&#39;code2&#39;</span><span class="p">,</span><span class="s1">&#39;code2&#39;</span><span class="p">:</span><span class="s1">&#39;code1&#39;</span><span class="p">})[[</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="s1">&#39;code1&#39;</span><span class="p">,</span><span class="s1">&#39;code2&#39;</span><span class="p">]]</span>

<span class="c1"># now we can use the code pairs as merge-keys</span>
<span class="n">trip_counts_und</span> <span class="o">=</span> <span class="n">trips_AB</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">trips_BA</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">,</span><span class="s1">&#39;code2&#39;</span><span class="p">],</span><span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">])</span>

<span class="n">trip_counts_und</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
      <th>counts_</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17409</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
      <td>Los Angeles International to San Francisco Int...</td>
      <td>2</td>
      <td>17757</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12461</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
      <td>John F. Kennedy International to Los Angeles I...</td>
      <td>4</td>
      <td>12463</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11298</td>
      <td>McCarran International</td>
      <td>Los Angeles International</td>
      <td>Las Vegas</td>
      <td>Los Angeles</td>
      <td>NV</td>
      <td>CA</td>
      <td>12889</td>
      <td>12892</td>
      <td>380.413047</td>
      <td>McCarran International to Los Angeles Internat...</td>
      <td>6</td>
      <td>11317</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10224</td>
      <td>Los Angeles International</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles</td>
      <td>Seattle</td>
      <td>CA</td>
      <td>WA</td>
      <td>12892</td>
      <td>14747</td>
      <td>1535.379400</td>
      <td>Los Angeles International to Seattle/Tacoma In...</td>
      <td>8</td>
      <td>10245</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9954</td>
      <td>Chicago O'Hare International</td>
      <td>LaGuardia</td>
      <td>Chicago</td>
      <td>New York</td>
      <td>IL</td>
      <td>NY</td>
      <td>13930</td>
      <td>12953</td>
      <td>1180.129320</td>
      <td>Chicago O'Hare International to LaGuardia&lt;br&gt;C...</td>
      <td>10</td>
      <td>10057</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># now we can sum both directions of the edge to create our undirected graph :)</span>
<span class="n">trip_counts_und</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_counts_und</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">trip_counts_und</span><span class="p">[</span><span class="s1">&#39;counts_&#39;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">trip_counts_und</span><span class="p">[</span><span class="s1">&#39;counts_&#39;</span><span class="p">]</span>

<span class="c1"># to complete, append the trips that only had one-way direction, and re-sort!</span>
<span class="n">trip_counts_und</span> <span class="o">=</span> <span class="n">trip_counts_und</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trip_neither</span><span class="p">)</span><span class="o">.</span>\
                      <span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span>\
                      <span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># finaly undirected graph!</span>
<span class="n">trip_counts_und</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>35166</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
      <td>Los Angeles International to San Francisco Int...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24924</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
      <td>John F. Kennedy International to Los Angeles I...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22615</td>
      <td>McCarran International</td>
      <td>Los Angeles International</td>
      <td>Las Vegas</td>
      <td>Los Angeles</td>
      <td>NV</td>
      <td>CA</td>
      <td>12889</td>
      <td>12892</td>
      <td>380.413047</td>
      <td>McCarran International to Los Angeles Internat...</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20469</td>
      <td>Los Angeles International</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles</td>
      <td>Seattle</td>
      <td>CA</td>
      <td>WA</td>
      <td>12892</td>
      <td>14747</td>
      <td>1535.379400</td>
      <td>Los Angeles International to Seattle/Tacoma In...</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20011</td>
      <td>Chicago O'Hare International</td>
      <td>LaGuardia</td>
      <td>Chicago</td>
      <td>New York</td>
      <td>IL</td>
      <td>NY</td>
      <td>13930</td>
      <td>12953</td>
      <td>1180.129320</td>
      <td>Chicago O'Hare International to LaGuardia&lt;br&gt;C...</td>
      <td>10</td>
    </tr>
    <tr>
      <th>5</th>
      <td>18254</td>
      <td>Honolulu International</td>
      <td>Kahului Airport</td>
      <td>Honolulu</td>
      <td>Kahului</td>
      <td>HI</td>
      <td>HI</td>
      <td>12173</td>
      <td>13830</td>
      <td>162.094231</td>
      <td>Honolulu International to Kahului Airport&lt;br&gt;H...</td>
      <td>15</td>
    </tr>
    <tr>
      <th>6</th>
      <td>18244</td>
      <td>San Francisco International</td>
      <td>McCarran International</td>
      <td>San Francisco</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>14771</td>
      <td>12889</td>
      <td>666.370587</td>
      <td>San Francisco International to McCarran Intern...</td>
      <td>14</td>
    </tr>
    <tr>
      <th>7</th>
      <td>18141</td>
      <td>Chicago O'Hare International</td>
      <td>Los Angeles International</td>
      <td>Chicago</td>
      <td>Los Angeles</td>
      <td>IL</td>
      <td>CA</td>
      <td>13930</td>
      <td>12892</td>
      <td>2807.429621</td>
      <td>Chicago O'Hare International to Los Angeles In...</td>
      <td>18</td>
    </tr>
    <tr>
      <th>8</th>
      <td>18093</td>
      <td>Hartsfield-Jackson Atlanta International</td>
      <td>Orlando International</td>
      <td>Atlanta</td>
      <td>Orlando</td>
      <td>GA</td>
      <td>FL</td>
      <td>10397</td>
      <td>13204</td>
      <td>649.748804</td>
      <td>Hartsfield-Jackson Atlanta International to Or...</td>
      <td>17</td>
    </tr>
    <tr>
      <th>9</th>
      <td>17042</td>
      <td>Ronald Reagan Washington National</td>
      <td>Logan International</td>
      <td>Washington</td>
      <td>Boston</td>
      <td>DC</td>
      <td>MA</td>
      <td>11278</td>
      <td>10721</td>
      <td>642.205372</td>
      <td>Ronald Reagan Washington National to Logan Int...</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="most-frequent-routes-in-us-during-the-past-year">
<h3><a class="toc-backref" href="#id9">Most frequent &#8220;routes&#8221; in US during the past year</a></h3>
<ul class="simple">
<li>To distinguish undirected edges from directed ones, I&#8217;ll call the
edges in the undirected graph <strong>&#8220;routes&#8221;</strong> , with the line of
thinking that trips A-&gt;B and B-&gt;A shares the same <em>route</em></li>
<li>(I&#8217;ll continue to call the directed edges <strong>trips</strong>)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">route_counts</span> <span class="o">=</span> <span class="n">trip_counts_und</span>
</pre></div>
</div>
<p>Let&#8217;s analyze the most frequent <strong>routes</strong> during the period Nov-1-2015
to Oct-31-2016</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s2">&quot;{} unique routes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">route_counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s1">&#39; the top 10 flight-routes during {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
<span class="n">route_counts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>2365 unique routes
=========== the top 10 flight-routes during 11/1/2015 to 10/31/2016 ============
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>counts</th>
      <th>Airport1</th>
      <th>Airport2</th>
      <th>City1</th>
      <th>City2</th>
      <th>State1</th>
      <th>State2</th>
      <th>code1</th>
      <th>code2</th>
      <th>distance</th>
      <th>text</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>35166</td>
      <td>Los Angeles International</td>
      <td>San Francisco International</td>
      <td>Los Angeles</td>
      <td>San Francisco</td>
      <td>CA</td>
      <td>CA</td>
      <td>12892</td>
      <td>14771</td>
      <td>543.531637</td>
      <td>Los Angeles International to San Francisco Int...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24924</td>
      <td>John F. Kennedy International</td>
      <td>Los Angeles International</td>
      <td>New York</td>
      <td>Los Angeles</td>
      <td>NY</td>
      <td>CA</td>
      <td>12478</td>
      <td>12892</td>
      <td>3983.079400</td>
      <td>John F. Kennedy International to Los Angeles I...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22615</td>
      <td>McCarran International</td>
      <td>Los Angeles International</td>
      <td>Las Vegas</td>
      <td>Los Angeles</td>
      <td>NV</td>
      <td>CA</td>
      <td>12889</td>
      <td>12892</td>
      <td>380.413047</td>
      <td>McCarran International to Los Angeles Internat...</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20469</td>
      <td>Los Angeles International</td>
      <td>Seattle/Tacoma International</td>
      <td>Los Angeles</td>
      <td>Seattle</td>
      <td>CA</td>
      <td>WA</td>
      <td>12892</td>
      <td>14747</td>
      <td>1535.379400</td>
      <td>Los Angeles International to Seattle/Tacoma In...</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20011</td>
      <td>Chicago O'Hare International</td>
      <td>LaGuardia</td>
      <td>Chicago</td>
      <td>New York</td>
      <td>IL</td>
      <td>NY</td>
      <td>13930</td>
      <td>12953</td>
      <td>1180.129320</td>
      <td>Chicago O'Hare International to LaGuardia&lt;br&gt;C...</td>
      <td>10</td>
    </tr>
    <tr>
      <th>5</th>
      <td>18254</td>
      <td>Honolulu International</td>
      <td>Kahului Airport</td>
      <td>Honolulu</td>
      <td>Kahului</td>
      <td>HI</td>
      <td>HI</td>
      <td>12173</td>
      <td>13830</td>
      <td>162.094231</td>
      <td>Honolulu International to Kahului Airport&lt;br&gt;H...</td>
      <td>15</td>
    </tr>
    <tr>
      <th>6</th>
      <td>18244</td>
      <td>San Francisco International</td>
      <td>McCarran International</td>
      <td>San Francisco</td>
      <td>Las Vegas</td>
      <td>CA</td>
      <td>NV</td>
      <td>14771</td>
      <td>12889</td>
      <td>666.370587</td>
      <td>San Francisco International to McCarran Intern...</td>
      <td>14</td>
    </tr>
    <tr>
      <th>7</th>
      <td>18141</td>
      <td>Chicago O'Hare International</td>
      <td>Los Angeles International</td>
      <td>Chicago</td>
      <td>Los Angeles</td>
      <td>IL</td>
      <td>CA</td>
      <td>13930</td>
      <td>12892</td>
      <td>2807.429621</td>
      <td>Chicago O'Hare International to Los Angeles In...</td>
      <td>18</td>
    </tr>
    <tr>
      <th>8</th>
      <td>18093</td>
      <td>Hartsfield-Jackson Atlanta International</td>
      <td>Orlando International</td>
      <td>Atlanta</td>
      <td>Orlando</td>
      <td>GA</td>
      <td>FL</td>
      <td>10397</td>
      <td>13204</td>
      <td>649.748804</td>
      <td>Hartsfield-Jackson Atlanta International to Or...</td>
      <td>17</td>
    </tr>
    <tr>
      <th>9</th>
      <td>17042</td>
      <td>Ronald Reagan Washington National</td>
      <td>Logan International</td>
      <td>Washington</td>
      <td>Boston</td>
      <td>DC</td>
      <td>MA</td>
      <td>11278</td>
      <td>10721</td>
      <td>642.205372</td>
      <td>Ronald Reagan Washington National to Logan Int...</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>  <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;Airport1&#39;</span><span class="p">]</span>
              <span class="o">+</span> <span class="s1">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;Airport2&#39;</span><span class="p">]</span>
              <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span>  <span class="o">+</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;City1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;State1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
              <span class="o">+</span> <span class="s1">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;City2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;State2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
              <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;Number of flights: &#39;</span> <span class="o">+</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>

<span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="nb">map</span><span class="p">(</span><span class="n">string_rank</span><span class="p">,</span><span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Los Angeles International &lt;-&gt; San Francisco International&lt;br&gt;Los Angeles (CA) &lt;-&gt; San Francisco (CA)&lt;br&gt;Number of flights: 35166&lt;br&gt;Ranking: 1st&#39;</span><span class="p">,</span>
 <span class="s1">&#39;John F. Kennedy International &lt;-&gt; Los Angeles International&lt;br&gt;New York (NY) &lt;-&gt; Los Angeles (CA)&lt;br&gt;Number of flights: 24924&lt;br&gt;Ranking: 2nd&#39;</span><span class="p">,</span>
 <span class="s1">&#39;McCarran International &lt;-&gt; Los Angeles International&lt;br&gt;Las Vegas (NV) &lt;-&gt; Los Angeles (CA)&lt;br&gt;Number of flights: 22615&lt;br&gt;Ranking: 3rd&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Los Angeles International &lt;-&gt; Seattle/Tacoma International&lt;br&gt;Los Angeles (CA) &lt;-&gt; Seattle (WA)&lt;br&gt;Number of flights: 20469&lt;br&gt;Ranking: 4th&#39;</span><span class="p">,</span>
 <span class="s2">&quot;Chicago O&#39;Hare International &lt;-&gt; LaGuardia&lt;br&gt;Chicago (IL) &lt;-&gt; New York (NY)&lt;br&gt;Number of flights: 20011&lt;br&gt;Ranking: 5th&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">route_counts</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">route_counts</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="c1"># raking info to give plotly</span>
<span class="c1"># route_counts.iplot(kind=&#39;bar&#39;,columns=[&#39;counts&#39;],text=&#39;text&#39;,filename=&#39;test&#39;,color=&#39;cyan&#39;)</span>


<span class="c1"># plot top_k</span>
<span class="n">top_k</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Most frequent &lt;b&gt;flights&lt;/b&gt; made in the US airports between {} (undirected network)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">top_k</span><span class="p">,</span><span class="n">period</span><span class="p">)</span>
<span class="n">title</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(hover over plots for the pairs of airports; left-click to pan-zoom)&#39;</span>
<span class="n">route_counts</span><span class="p">[:</span><span class="n">top_k</span><span class="p">]</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                          <span class="n">xTitle</span><span class="o">=</span><span class="s1">&#39;Ranking&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;topk_routes&#39;</span><span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1951.embed?link=false&logo=false&share_key=mwagthg1Y2h7lqjZUTXlGu" height="525px" width="100%"></iframe><p>Ok, the above is nice, but the charts above does not convey the
geographical information about the network architecture of the US
Airflight system.</p>
<p>We&#8217;ll finally turn out attention to tools from network theory.</p>
<p><strong>The next setcion only contains helper codes that are rather specific
to ``networkx``, so can be skipped entirely</strong></p>
</div>
</div>
<div class="section" id="only-codes-can-be-skipped-define-helper-functions-for-complex-network-analysis">
<h2><a class="toc-backref" href="#id10">(only codes, can be skipped) Define helper functions for complex network analysis</a></h2>
<ul class="simple">
<li>this section defines a set of helper functions that I wrote for my
own convenience.</li>
<li>please skip to next section for actual analysis</li>
</ul>
<div class="section" id="make-nx-graph-create-networkx-graph-object">
<h3><a class="toc-backref" href="#id11">make_nx_graph: create networkx graph object</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_nx_graph</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="n">df_lookup</span><span class="p">,</span><span class="n">digraph</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert airflight-counts between airport pairs into networkx Graph object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    counts : pandas.DataFrame</span>
<span class="sd">        Table containing the trip_counts (digraph) or route_counts (undirected graph)</span>
<span class="sd">        Use for later network analysis scripts</span>
<span class="sd">    df_lookup : pandas.DataFrame</span>
<span class="sd">        Lookup table created in  http://takwatanabe.me/airtraffic/create_lookup_table.html</span>
<span class="sd">        (used to map airport-id key quantities of interest)</span>
<span class="sd">    digraph : bool</span>
<span class="sd">        Is the graph directed? (default = False, so undirected)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">digraph</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span> <span class="c1"># directed graph</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>   <span class="c1"># undirected graph</span>

    <span class="c1"># === provide node information === #</span>
    <span class="c1"># get unique set of nodes in the graph</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span>
                <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;code2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

    <span class="c1"># --- add airport name as node attribute (handy for later analysis in Gephi) ---</span>
    <span class="c1"># --- to do this, need to pass a dictionary to networkx</span>
    <span class="n">hash_airport</span>   <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;Airport&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="c1"># filter away airports in the lookup-table absent in the graph</span>
    <span class="n">nodes_airport</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">hash_airport</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;airport&#39;</span><span class="p">,</span> <span class="n">nodes_airport</span><span class="p">)</span>

    <span class="c1"># --- add airport latitude/longitude information ---</span>
    <span class="n">hash_lat</span>       <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">hash_lon</span>       <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="sd">&quot;&quot;&quot; Warning (why the typecasting below is important)</span>
<span class="sd">    Pandas returns data type in numpy.float64 for floats, which is not</span>
<span class="sd">    supported in ``networkx.write_gexf`` (learned this the hard way...)</span>

<span class="sd">    http://stackoverflow.com/questions/22037360/keyerror-when-writing-numpy-values-to-gexf-with-networkx</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># apply filering with typecasting from numpy.float64 to float</span>
    <span class="n">nodes_lat</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">hash_lat</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
    <span class="n">nodes_lon</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">hash_lon</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">nodes_lat</span><span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">nodes_lon</span><span class="p">)</span>

    <span class="c1"># === add weighted edge information (flight counts in our context) === #</span>
    <span class="c1"># to define edge, supply a 3-tuple of ``(node1,node2,dict(weight=edge))``</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s1">&#39;code1&#39;</span><span class="p">],</span> <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;code2&#39;</span><span class="p">],</span> <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

    <span class="c1"># === done! ready to return, except one more step! ===</span>
    <span class="c1"># instead of using the Airport_ID as the node-labels, let&#39;s instead use the</span>
    <span class="c1"># City+State information, which is unique so can be used as lookup-keys</span>
    <span class="n">hash_citystate</span> <span class="o">=</span> <span class="n">df_lookup</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Code&#39;</span><span class="p">)[</span><span class="s1">&#39;City_State&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">nodes_citystate</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">hash_citystate</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">nodes_citystate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
</div>
<div class="section" id="compute-network-measures-network-measures-characterizing-nodes-airport">
<h3><a class="toc-backref" href="#id12">compute_network_measures: network measures characterizing nodes (airport)</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_network_measures</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">add_module_attr</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Compute a set of well studied complex network measures</span>

<span class="sd">    The measures characterizes individual nodes in the network</span>
<span class="sd">    (in  our context, characterizes the airport)</span>

<span class="sd">    - pagerank: Google page-rank centrality</span>
<span class="sd">    - eig_cent: Eigen-value centrality</span>
<span class="sd">    - bet_cent: Betweenness centrality</span>
<span class="sd">    - clust_coef: Clustering coefficient (only implemented for undirected graph)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    G : networkx graph object</span>
<span class="sd">        networkx graph object returned from ``make_nx_graph``.</span>
<span class="sd">        Can be directed or undirected.</span>
<span class="sd">    add_module_attr : bool</span>
<span class="sd">        Add module information to the input G inplace.</span>
<span class="sd">        Helpful when wanting to export object as ``*.gexf`` file for</span>
<span class="sd">        analysis in Gephi.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">to_numpy_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>

    <span class="n">degree_wei</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># weighted degree</span>
    <span class="n">degree_bin</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># binary degree</span>

    <span class="c1"># appply modularity algorithm to detect communities of airports</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">bct</span><span class="o">.</span><span class="n">modularity_louvain_und</span><span class="p">(</span><span class="n">bct</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># convert numpy array into dictionary with node-label</span>
    <span class="n">degree_wei</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span><span class="n">deg</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">deg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">degree_wei</span><span class="p">)}</span>
    <span class="n">degree_bin</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span><span class="n">deg</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">deg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">degree_bin</span><span class="p">)}</span>
    <span class="n">module</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">modu</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">modu</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">module</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">add_module_attr</span><span class="p">:</span>
        <span class="c1"># add community label as node attributes</span>
        <span class="c1"># (handy when exporting .gexf file)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;modu&#39;</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>

    <span class="c1"># nodal centrality measures</span>
    <span class="n">pagerank</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>               <span class="c1"># google page-rank</span>
    <span class="n">eig_cent</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">eigenvector_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">)</span> <span class="c1"># eigenvalue centrality</span>
    <span class="n">bet_cent</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">)</span> <span class="c1"># betweennes centrality</span>

    <span class="c1"># create dictionary of each of the measures computed above</span>
    <span class="c1"># (to be convertd to dataframe at end)</span>
    <span class="n">df_network</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pagerank</span><span class="o">=</span><span class="n">pagerank</span><span class="p">,</span>
                      <span class="n">eig_cent</span><span class="o">=</span><span class="n">eig_cent</span><span class="p">,</span>
                      <span class="n">bet_cent</span><span class="o">=</span><span class="n">bet_cent</span><span class="p">,</span>
                      <span class="n">degree_wei</span><span class="o">=</span><span class="n">degree_wei</span><span class="p">,</span>
                      <span class="n">degree_bin</span><span class="o">=</span><span class="n">degree_bin</span><span class="p">,</span>
                      <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">digraph</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">):</span>
        <span class="c1"># clustering coefficient (tendency of a node to cluster together)</span>
        <span class="c1"># (not implemented for digraphs)</span>
        <span class="n">clust_coef</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">clustering</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="n">G</span><span class="p">)</span>
        <span class="n">df_network</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">clust_coef</span><span class="o">=</span><span class="n">clust_coef</span><span class="p">))</span>

    <span class="c1"># all set! convert dict to dataframe and return :)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_network</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="other-helper-functions">
<h3><a class="toc-backref" href="#id13">Other helper functions</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">string_rank</span><span class="p">(</span><span class="n">ranking</span><span class="p">):</span>
    <span class="n">headstr</span> <span class="o">=</span> <span class="s1">&#39;Ranking: &#39;</span>
    <span class="k">if</span> <span class="n">ranking</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="s1">&#39;1st&#39;</span>
    <span class="k">elif</span> <span class="n">ranking</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="s1">&#39;2nd&#39;</span>
    <span class="k">elif</span> <span class="n">ranking</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="s1">&#39;3rd&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">headstr</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ranking</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;th&#39;</span>

<span class="k">def</span> <span class="nf">add_ranking_hover_text</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
    <span class="n">hover_text</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Airport&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> \
               <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;City&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> \
               <span class="o">+</span> <span class="n">description</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hover_text</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="nb">map</span><span class="p">(</span><span class="n">string_rank</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_base_plotly_layout</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; This layout will be used repeatedly &quot;&quot;&quot;</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">showlegend</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">font</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">),</span>
                <span class="c1">#bordercolor=&#39;rgb(0,0,0)&#39;,</span>
                <span class="c1">#borderwidth=1,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">1.08</span><span class="p">,</span>
                <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">geo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;usa&#39;</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;albers usa&#39;</span> <span class="p">),</span>
                <span class="n">showland</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                <span class="n">landcolor</span> <span class="o">=</span> <span class="s1">&#39;rgb(217, 217, 217)&#39;</span><span class="p">,</span>
                <span class="n">subunitwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">countrywidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">subunitcolor</span><span class="o">=</span><span class="s2">&quot;rgb(255, 255, 255)&quot;</span><span class="p">,</span>
                <span class="n">countrycolor</span><span class="o">=</span><span class="s2">&quot;rgb(255, 255, 255)&quot;</span>
            <span class="p">),</span>
            <span class="n">margin</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">125</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">layout</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="complex-network-theory-in-action">
<h2><a class="toc-backref" href="#id14">Complex network theory in action!</a></h2>
<ul class="simple">
<li>below, we will focus on <strong>undirected graph</strong>, but a very similar
result can be obtained using directed graph</li>
<li>(which makes sense, since most of the flights consist of round-trips)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">measure_abbrev</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bet_cent&#39;</span><span class="p">:</span> <span class="s1">&#39;Betweenness Centrality&#39;</span><span class="p">,</span>
    <span class="s1">&#39;clust_coef&#39;</span><span class="p">:</span> <span class="s1">&#39;Clustering Coefficient&#39;</span><span class="p">,</span>
    <span class="s1">&#39;degree_bin&#39;</span> <span class="p">:</span> <span class="s1">&#39;Binary Degree&#39;</span><span class="p">,</span>
    <span class="s1">&#39;degree_wei&#39;</span> <span class="p">:</span> <span class="s1">&#39;Weighted Degree&#39;</span><span class="p">,</span>
    <span class="s1">&#39;eig_cent&#39;</span><span class="p">:</span> <span class="s1">&#39;Eigenvalue Centrality&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pagerank&#39;</span><span class="p">:</span> <span class="s1">&#39;Google PageRank Cenrality&#39;</span><span class="p">,</span>
    <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;Community membership&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">make_nx_graph</span><span class="p">(</span><span class="n">route_counts</span><span class="p">,</span><span class="n">df_lookup</span><span class="p">,</span><span class="n">digraph</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">df_network</span> <span class="o">=</span> <span class="n">compute_network_measures</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">add_module_attr</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">df_network</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_network</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">num</span><span class="p">:</span> <span class="s1">&#39;Module &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
<span class="n">df_network</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bet_cent</th>
      <th>clust_coef</th>
      <th>degree_bin</th>
      <th>degree_wei</th>
      <th>eig_cent</th>
      <th>module</th>
      <th>pagerank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Aberdeen (SD)</th>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1484</td>
      <td>0.001100</td>
      <td>Module 4</td>
      <td>0.000590</td>
    </tr>
    <tr>
      <th>Abilene (TX)</th>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>1</td>
      <td>1019</td>
      <td>0.001120</td>
      <td>Module 1</td>
      <td>0.000548</td>
    </tr>
    <tr>
      <th>Adak Island (AK)</th>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>1</td>
      <td>210</td>
      <td>0.000021</td>
      <td>Module 2</td>
      <td>0.000512</td>
    </tr>
    <tr>
      <th>Aguadilla (PR)</th>
      <td>7.630803e-07</td>
      <td>0.833333</td>
      <td>4</td>
      <td>3642</td>
      <td>0.002570</td>
      <td>Module 3</td>
      <td>0.000696</td>
    </tr>
    <tr>
      <th>Akron (OH)</th>
      <td>1.396953e-05</td>
      <td>0.777778</td>
      <td>9</td>
      <td>11059</td>
      <td>0.012991</td>
      <td>Module 1</td>
      <td>0.001239</td>
    </tr>
  </tbody>
</table>
</div><p>Let&#8217;s quickly peruse the distribution of these network measures</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">FF</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">FigureFactory</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">create_scatterplotmatrix</span><span class="p">(</span><span class="n">df_network</span><span class="p">,</span><span class="n">diag</span><span class="o">=</span><span class="s1">&#39;histogram&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;module&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">650</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Scatterplot Matrix of Complex Network Measures&#39;</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;_scattermat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>This is the format of your plot grid:
[ (1,1) x1,y1 ]    [ (1,2) x2,y2 ]    [ (1,3) x3,y3 ]    [ (1,4) x4,y4 ]    [ (1,5) x5,y5 ]    [ (1,6) x6,y6 ]
[ (2,1) x7,y7 ]    [ (2,2) x8,y8 ]    [ (2,3) x9,y9 ]    [ (2,4) x10,y10 ]  [ (2,5) x11,y11 ]  [ (2,6) x12,y12 ]
[ (3,1) x13,y13 ]  [ (3,2) x14,y14 ]  [ (3,3) x15,y15 ]  [ (3,4) x16,y16 ]  [ (3,5) x17,y17 ]  [ (3,6) x18,y18 ]
[ (4,1) x19,y19 ]  [ (4,2) x20,y20 ]  [ (4,3) x21,y21 ]  [ (4,4) x22,y22 ]  [ (4,5) x23,y23 ]  [ (4,6) x24,y24 ]
[ (5,1) x25,y25 ]  [ (5,2) x26,y26 ]  [ (5,3) x27,y27 ]  [ (5,4) x28,y28 ]  [ (5,5) x29,y29 ]  [ (5,6) x30,y30 ]
[ (6,1) x31,y31 ]  [ (6,2) x32,y32 ]  [ (6,3) x33,y33 ]  [ (6,4) x34,y34 ]  [ (6,5) x35,y35 ]  [ (6,6) x36,y36 ]
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1953.embed?link=false&logo=false&share_key=gGIBKQOHB5hkU1UgIIoq2z" height="650px" width="800px"></iframe><ul class="simple">
<li>High <strong>`centrality &lt;https://en.wikipedia.org/wiki/Centrality&gt;`__</strong>
indicates the airports of high importance, such as number of
connections an airport provides (eg, hub structure from nodes with
high degree).</li>
<li>The centrality measures, appear to indicate a
<strong>`power-law &lt;https://en.wikipedia.org/wiki/Power_law&gt;`__</strong>
disttribution, hinting that the US airtraffic system forms what is
known as a <a class="reference external" href="en.wikipedia.org/wiki/Scale-free_network">scale-free
structure</a></li>
</ul>
<div class="section" id="power-law-analysis-of-centrality-measures">
<h3><a class="toc-backref" href="#id15">Power law analysis of centrality measures</a></h3>
<ul class="simple">
<li>we&#8217;ll visually examine how well the distribution of the cenrality
measures fit the power-law distribution.</li>
</ul>
<p><strong>CREDIT</strong>: code inspired from Philip Singer&#8217;s blog post.</p>
<p><a class="reference external" href="http://www.philippsinger.info/?p=247">http://www.philippsinger.info/?p=247</a></p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">powerlaw</span>

<span class="n">_</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">sns_subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span>

<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="n">measure_abbrev</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="k">continue</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">powerlaw</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">df_network</span><span class="p">[</span><span class="n">measure</span><span class="p">])</span>

    <span class="n">fit</span><span class="o">.</span><span class="n">plot_ccdf</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">measure_abbrev</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">fit</span><span class="o">.</span><span class="n">power_law</span><span class="o">.</span><span class="n">plot_ccdf</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Power law fit&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">r&quot;$p(X\geq x)$&quot;</span><span class="p">)</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">measure_abbrev</span><span class="p">[</span><span class="n">measure</span><span class="p">])</span>
</pre></div>
</div>
<div class="myliteral highlight-python"><div class="highlight"><pre><span></span>Calculating best minimal value for power law fit
Values less than or equal to 0 in data. Throwing out 0 or negative values
Calculating best minimal value for power law fit
Values less than or equal to 0 in data. Throwing out 0 or negative values
Calculating best minimal value for power law fit
Calculating best minimal value for power law fit
Calculating best minimal value for power law fit
Calculating best minimal value for power law fit
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/network_analysis_48_1.png"><img alt="_images/network_analysis_48_1.png" src="_images/network_analysis_48_1.png" style="width: 854.0px; height: 665.0px;" /></a>
<ul class="simple">
<li>Outside of clustering coefficient (which is not a centrality
measure), measures seem to exhibit the property of the Power-law
distribution to an extent.</li>
<li>The <a class="reference external" href="https://en.wikipedia.org/wiki/PageRank">Google PageRank
centrality</a> seems to
exhibit the best fit.</li>
</ul>
</div>
<div class="section" id="pagerank-centrality-among-us-airports">
<h3><a class="toc-backref" href="#id16">PageRank Centrality among US Airports</a></h3>
<ul class="simple">
<li>let&#8217;s identify the most important nodes according to the Google
PageRank algorithm, one of the best known algorithms from Google that
measures the importance of a node (site) in the world-wide-web graph.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;pagerank&#39;</span>

<span class="c1"># join data-table with pagerank with the lookup table (City_State is unique, so is a valid merge keu)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_network</span><span class="p">[</span><span class="n">measure</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;City_State&#39;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_lookup</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;City_State&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">measure</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City_State</th>
      <th>pagerank</th>
      <th>Code</th>
      <th>Description</th>
      <th>Airport</th>
      <th>City</th>
      <th>State</th>
      <th>Region</th>
      <th>lat</th>
      <th>lon</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Atlanta (GA)</td>
      <td>0.064983</td>
      <td>10397</td>
      <td>Atlanta, GA: Hartsfield-Jackson Atlanta Intern...</td>
      <td>Hartsfield-Jackson Atlanta International</td>
      <td>Atlanta</td>
      <td>GA</td>
      <td>South</td>
      <td>33.640728</td>
      <td>-84.427700</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Chicago (IL) [O'Hare]</td>
      <td>0.044911</td>
      <td>13930</td>
      <td>Chicago, IL: Chicago O'Hare International</td>
      <td>Chicago O'Hare International</td>
      <td>Chicago</td>
      <td>IL</td>
      <td>Midwest</td>
      <td>41.974162</td>
      <td>-87.907321</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Dallas/Fort Worth (TX)</td>
      <td>0.037017</td>
      <td>11298</td>
      <td>Dallas/Fort Worth, TX: Dallas/Fort Worth Inter...</td>
      <td>Dallas/Fort Worth International</td>
      <td>Dallas/Fort Worth</td>
      <td>TX</td>
      <td>South</td>
      <td>32.899809</td>
      <td>-97.040335</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Denver (CO)</td>
      <td>0.036630</td>
      <td>11292</td>
      <td>Denver, CO: Denver International</td>
      <td>Denver International</td>
      <td>Denver</td>
      <td>CO</td>
      <td>West</td>
      <td>39.856096</td>
      <td>-104.673738</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Los Angeles (CA)</td>
      <td>0.029119</td>
      <td>12892</td>
      <td>Los Angeles, CA: Los Angeles International</td>
      <td>Los Angeles International</td>
      <td>Los Angeles</td>
      <td>CA</td>
      <td>West</td>
      <td>33.941589</td>
      <td>-118.408530</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># remove illegal latitude locations from plotly</span>
<span class="c1"># (everything outside 50states+DC...so drops Virgin Island, Guam,Puerto rico, etc)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">19</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">add_ranking_hover_text</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span><span class="n">measure</span><span class="p">,</span><span class="s1">&#39;PageRank Score&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">ranking_group</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="mi">25</span><span class="p">,</span><span class="mi">50</span><span class="p">),(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">),(</span><span class="mi">100</span><span class="p">,</span><span class="mi">300</span><span class="p">)]</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.00005</span> <span class="c1"># scaling factor for the bubble plots</span>

<span class="c1"># colors for each ranking group</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rgb(0,116,217)&quot;</span><span class="p">,</span><span class="s2">&quot;rgb(255,65,54)&quot;</span><span class="p">,</span><span class="s2">&quot;rgb(133,20,75)&quot;</span><span class="p">,</span><span class="s2">&quot;rgb(255,133,27)&quot;</span><span class="p">,</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ranking_group</span><span class="p">)):</span>
    <span class="n">lim</span> <span class="o">=</span> <span class="n">ranking_group</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">airport</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;scattergeo&#39;</span><span class="p">,</span>
        <span class="n">locationmode</span> <span class="o">=</span> <span class="s1">&#39;USA-states&#39;</span><span class="p">,</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="n">lat</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="n">measure</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="n">sizemode</span> <span class="o">=</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">line</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(40,40,40)&#39;</span><span class="p">),),</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Top {0} - {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">airport</span><span class="p">)</span>

<span class="n">layout</span> <span class="o">=</span> <span class="n">get_base_plotly_layout</span><span class="p">()</span>
<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Top 300 airports based on Google PageRank Centrality ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(hover for airport info; click legend below to toggle on/off ranking-groups)&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span> <span class="p">)</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span> <span class="n">fig</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;page_rank&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1955.embed?link=false&logo=false&share_key=b2DdhlljEH0JZMTRVPlUjf" height="525px" width="100%"></iframe><p>Above plot is quite insightful!</p>
<p>As a Michigan native, proud to see Detroit Airport score in the top 10.</p>
</div>
<div class="section" id="communities-detected-via-modularity-score">
<h3><a class="toc-backref" href="#id17">Communities Detected via Modularity Score</a></h3>
<p>We next analyze the <strong>communities</strong> of airports that were identified by
the <a class="reference external" href="https://en.wikipedia.org/wiki/Girvan%E2%80%93Newman_algorithm">Girvan-Newman modularity
algorithm</a>.</p>
<p>A <strong>community</strong> describes a set of airports that tend to connect with
each other.</p>
<p>To gain geographical insight, we&#8217;ll again display the results on the US
map.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;degree_bin&#39;</span> <span class="c1"># make bubble size proportional to binary degree</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_network</span><span class="p">[[</span><span class="n">measure</span><span class="p">,</span><span class="s1">&#39;module&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;City_State&#39;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_lookup</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;City_State&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">measure</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># remove illegal latitude locations from plotly</span>
<span class="c1"># (everything outside 50states+DC...so drops Virgin Island, Guam,Puerto rico, etc)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">19</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">add_ranking_hover_text</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span><span class="n">measure</span><span class="p">,</span><span class="s1">&#39;Binary Degree&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City_State</th>
      <th>degree_bin</th>
      <th>module</th>
      <th>Code</th>
      <th>Description</th>
      <th>Airport</th>
      <th>City</th>
      <th>State</th>
      <th>Region</th>
      <th>lat</th>
      <th>lon</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Atlanta (GA)</td>
      <td>166</td>
      <td>Module 1</td>
      <td>10397</td>
      <td>Atlanta, GA: Hartsfield-Jackson Atlanta Intern...</td>
      <td>Hartsfield-Jackson Atlanta International</td>
      <td>Atlanta</td>
      <td>GA</td>
      <td>South</td>
      <td>33.640728</td>
      <td>-84.427700</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Chicago (IL) [O'Hare]</td>
      <td>163</td>
      <td>Module 4</td>
      <td>13930</td>
      <td>Chicago, IL: Chicago O'Hare International</td>
      <td>Chicago O'Hare International</td>
      <td>Chicago</td>
      <td>IL</td>
      <td>Midwest</td>
      <td>41.974162</td>
      <td>-87.907321</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Dallas/Fort Worth (TX)</td>
      <td>145</td>
      <td>Module 1</td>
      <td>11298</td>
      <td>Dallas/Fort Worth, TX: Dallas/Fort Worth Inter...</td>
      <td>Dallas/Fort Worth International</td>
      <td>Dallas/Fort Worth</td>
      <td>TX</td>
      <td>South</td>
      <td>32.899809</td>
      <td>-97.040335</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Denver (CO)</td>
      <td>135</td>
      <td>Module 2</td>
      <td>11292</td>
      <td>Denver, CO: Denver International</td>
      <td>Denver International</td>
      <td>Denver</td>
      <td>CO</td>
      <td>West</td>
      <td>39.856096</td>
      <td>-104.673738</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Houston (TX) [G.Bush]</td>
      <td>122</td>
      <td>Module 1</td>
      <td>12266</td>
      <td>Houston, TX: George Bush Intercontinental/Houston</td>
      <td>George Bush Intercontinental/Houston</td>
      <td>Houston</td>
      <td>TX</td>
      <td>South</td>
      <td>29.990220</td>
      <td>-95.336783</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">community_group</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="n">scale</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span> <span class="c1"># scaling factor for the bubble plots</span>

<span class="c1"># colors for each community group</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rgb(0,116,217)&quot;</span><span class="p">,</span><span class="s2">&quot;rgb(255,65,54)&quot;</span><span class="p">,</span><span class="s2">&quot;rgb(133,20,75)&quot;</span><span class="p">,</span><span class="s2">&quot;rgb(255,133,27)&quot;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">community</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">community_group</span><span class="p">):</span>
    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;module == @community&#39;</span><span class="p">)</span>
    <span class="n">airport</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;scattergeo&#39;</span><span class="p">,</span>
        <span class="n">locationmode</span> <span class="o">=</span> <span class="s1">&#39;USA-states&#39;</span><span class="p">,</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="n">lat</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="n">measure</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="n">sizemode</span> <span class="o">=</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">line</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(40,40,40)&#39;</span><span class="p">),),</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">community</span>
    <span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">airport</span><span class="p">)</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">get_base_plotly_layout</span><span class="p">()</span>
<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Communities detected among the US Airports using Louvain Modularity Algorithm&#39;</span>
<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">+=</span> <span class="s1">&#39;&lt;br&gt;(nodes scaled by binary degree; click legend below to toggle on/off community display)&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span> <span class="p">)</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span> <span class="n">fig</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;communities&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~takanori/1957.embed?link=false&logo=false&share_key=KybShvlrzWuZ5pwbUUwQOq" height="525px" width="100%"></iframe><p>From the above chart, we can quickly see that the US airport community
is mostly based on geographical distance.</p>
<p>In fact, I was quite surprised to see how closely the communities
resemble the <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_regions_of_the_United_States">four regions of the United
Stats</a>
assigned by the Census Bureau (Northeast, South, Midwest, and West
regions), which was fascinating since the Girvan-Newman modularity
algorithm was purely driven by the Airline traffic data. It could be
possible that policy-makers assign flight schedule based o these four
regions, but it was still cool to see the data pick this up.</p>
<p>Finally, it was interesting to see Washingto DC be part of the Western
region dominant red community.</p>
</div>
<div class="section" id="visualizing-the-airtraffics-in-gephi">
<h3><a class="toc-backref" href="#id18">Visualizing the airtraffics in Gephi</a></h3>
<p>We conclude our analysis by producing the overall graph structure in the
US airline by rendering the edges on the US map using
<a class="reference external" href="https://gephi.org/">Gephi</a>.</p>
<p>To do this, we exported the Graph object in networkx as a GEXF (Graph
Exchange XML Format) file.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># export graph object with the module information for visualizing in Gephi</span>
<span class="n">nx</span><span class="o">.</span><span class="n">write_gexf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;airtraffic_network.gexf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Below are the result of the figures rendered in Gephi in SVG format.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span>
<span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s1">&#39;./gephi/traffic_mainland.svg&#39;</span><span class="p">))</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/network_analysis_65_0.svg"><img src="_images/network_analysis_65_0.svg" /></a>
<p>Finally, below we display only the <em>intra</em>-community edges to avoid
cluttering the figure with edges.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s1">&#39;./gephi/traffic_mainland_intra_only.svg&#39;</span><span class="p">))</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/network_analysis_67_0.svg"><img src="_images/network_analysis_67_0.svg" /></a>
<p>We can also obtain a hierarchical module/community by running another
recursion of community detection algorithm, as illustrated below.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s1">&#39;./gephi/south.svg&#39;</span><span class="p">))</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/network_analysis_69_0.svg"><img src="_images/network_analysis_69_0.svg" /></a>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s1">&#39;./gephi/midwest.svg&#39;</span><span class="p">))</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/network_analysis_70_0.svg"><img src="_images/network_analysis_70_0.svg" /></a>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s1">&#39;./gephi/west.svg&#39;</span><span class="p">))</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/network_analysis_71_0.svg"><img src="_images/network_analysis_71_0.svg" /></a>
<p>Other visualization charts that we created in Gephi is available at
<a class="reference external" href="https://github.com/wtak23/airtraffic/tree/master/final_scripts/gephi">https://github.com/wtak23/airtraffic/tree/master/final_scripts/gephi</a></p>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id19">Conclusion</a></h2>
<p>As an overall concluding remark, I am glad I undertook this data science
project.
I learned a lot about the seasonal and geographical trends present in  the US air-traffic system, and also became familiar about the network architecture of the sytem in terms of centrality and modularity. ,</p>
<p>I was also able to get my hands wet on utilizing variety of practical tools, such as included web-scraping, API querying, geocoding, visualization of network graphs, dataframe manipulation and data tidying, and creating
intuitive visualization charts that helps data to deliver the message to us analysts.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>